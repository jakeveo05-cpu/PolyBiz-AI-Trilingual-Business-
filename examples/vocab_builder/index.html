<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyBiz AI - Vocabulary Builder ËØçÊ±áÂ≠¶‰π†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh; color: #fff; padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }
        
        .card {
            background: rgba(255,255,255,0.05); border-radius: 15px;
            padding: 25px; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Stats Bar */
        .stats-bar {
            display: flex; justify-content: space-around; padding: 15px;
            background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 20px;
        }
        .stat-item { text-align: center; }
        .stat-value { font-size: 1.5em; font-weight: bold; color: #60a5fa; }
        .stat-label { font-size: 0.8em; color: #888; }
        .stat-value.new { color: #3b82f6; }
        .stat-value.learning { color: #f59e0b; }
        .stat-value.review { color: #22c55e; }
        .stat-value.mastered { color: #a855f7; }
        
        /* Topic Selector */
        .topics-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px; margin-bottom: 20px;
        }
        .topic-card {
            padding: 20px 15px; background: rgba(255,255,255,0.05);
            border: 2px solid transparent; border-radius: 12px;
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .topic-card:hover { border-color: #60a5fa; transform: translateY(-2px); }
        .topic-card.selected { border-color: #3b82f6; background: rgba(59,130,246,0.2); }
        .topic-icon { font-size: 2em; margin-bottom: 8px; }
        .topic-name { font-weight: bold; margin-bottom: 4px; }
        .topic-count { font-size: 0.8em; color: #888; }
        .topic-progress {
            height: 4px; background: rgba(255,255,255,0.1);
            border-radius: 2px; margin-top: 8px; overflow: hidden;
        }
        .topic-progress-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
        
        /* Mode Tabs */
        .mode-tabs {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .mode-tab {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            background: rgba(255,255,255,0.05); color: #888;
            cursor: pointer; transition: all 0.2s; font-size: 14px;
        }
        .mode-tab:hover { background: rgba(255,255,255,0.1); }
        .mode-tab.active { background: rgba(59,130,246,0.3); color: #fff; }
        .mode-tab .count {
            display: inline-block; padding: 2px 8px; border-radius: 10px;
            background: rgba(255,255,255,0.1); font-size: 0.85em; margin-left: 5px;
        }
        
        /* Flashcard */
        .flashcard-container {
            perspective: 1000px; margin-bottom: 20px;
        }
        .flashcard {
            width: 100%; min-height: 300px; position: relative;
            transform-style: preserve-3d; transition: transform 0.6s;
            cursor: pointer;
        }
        .flashcard.flipped { transform: rotateY(180deg); }
        .flashcard-face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 20px;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            padding: 30px;
        }
        .flashcard-front {
            background: linear-gradient(135deg, rgba(59,130,246,0.3), rgba(139,92,246,0.3));
            border: 2px solid rgba(59,130,246,0.5);
        }
        .flashcard-back {
            background: linear-gradient(135deg, rgba(34,197,94,0.3), rgba(20,184,166,0.3));
            border: 2px solid rgba(34,197,94,0.5);
            transform: rotateY(180deg);
        }
        .card-hanzi {
            font-size: 5em; font-family: 'Noto Sans SC', serif;
            margin-bottom: 15px; text-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        .card-pinyin { font-size: 1.8em; color: #fbbf24; margin-bottom: 10px; }
        .card-meaning { font-size: 1.3em; color: #aaa; }
        .card-example {
            margin-top: 20px; padding: 15px; background: rgba(0,0,0,0.2);
            border-radius: 10px; text-align: center;
        }
        .example-zh { font-size: 1.2em; margin-bottom: 5px; }
        .example-vi { color: #888; font-size: 0.95em; }
        .card-audio {
            position: absolute; top: 15px; right: 15px;
            padding: 10px; background: rgba(255,255,255,0.1);
            border: none; border-radius: 50%; cursor: pointer;
            font-size: 1.2em; transition: all 0.2s;
        }
        .card-audio:hover { background: rgba(255,255,255,0.2); transform: scale(1.1); }
        .card-level {
            position: absolute; top: 15px; left: 15px;
            padding: 5px 12px; border-radius: 15px; font-size: 0.8em;
        }
        .level-new { background: rgba(59,130,246,0.3); color: #60a5fa; }
        .level-learning { background: rgba(245,158,11,0.3); color: #fbbf24; }
        .level-review { background: rgba(34,197,94,0.3); color: #22c55e; }
        .level-mastered { background: rgba(168,85,247,0.3); color: #a855f7; }
        
        /* SRS Buttons */
        .srs-buttons {
            display: flex; gap: 10px; justify-content: center;
        }
        .srs-btn {
            flex: 1; max-width: 150px; padding: 15px 20px;
            border: none; border-radius: 12px; cursor: pointer;
            font-size: 14px; font-weight: bold; transition: all 0.2s;
        }
        .srs-btn:hover { transform: translateY(-2px); }
        .srs-again { background: #ef4444; color: #fff; }
        .srs-hard { background: #f59e0b; color: #000; }
        .srs-good { background: #22c55e; color: #fff; }
        .srs-easy { background: #3b82f6; color: #fff; }
        .srs-btn .interval { display: block; font-size: 0.75em; opacity: 0.8; margin-top: 3px; }
        
        /* Progress */
        .session-progress {
            display: flex; align-items: center; gap: 15px;
            padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;
        }
        .progress-bar {
            flex: 1; height: 10px; background: rgba(255,255,255,0.1);
            border-radius: 5px; overflow: hidden;
        }
        .progress-fill { height: 100%; background: #22c55e; transition: width 0.3s; }
        .progress-text { color: #888; font-size: 0.9em; white-space: nowrap; }
        
        /* Word List */
        .word-list { max-height: 400px; overflow-y: auto; }
        .word-item {
            display: flex; align-items: center; gap: 15px;
            padding: 12px 15px; border-radius: 10px;
            background: rgba(255,255,255,0.03); margin-bottom: 8px;
            cursor: pointer; transition: all 0.2s;
        }
        .word-item:hover { background: rgba(255,255,255,0.08); }
        .word-hanzi { font-size: 1.5em; font-family: 'Noto Sans SC', serif; width: 60px; }
        .word-info { flex: 1; }
        .word-pinyin { color: #fbbf24; font-size: 0.9em; }
        .word-meaning { color: #888; font-size: 0.85em; }
        .word-level {
            padding: 4px 10px; border-radius: 10px; font-size: 0.75em;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center; padding: 60px 20px; color: #666;
        }
        .empty-icon { font-size: 4em; margin-bottom: 15px; opacity: 0.5; }
        
        /* Buttons */
        .btn {
            padding: 12px 25px; border: none; border-radius: 10px;
            cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .btn-primary { background: #3b82f6; color: #fff; }
        .btn-success { background: #22c55e; color: #fff; }
        .btn-secondary { background: #6b7280; color: #fff; }
        .btn:hover { transform: scale(1.05); }
        
        /* Flip hint */
        .flip-hint {
            text-align: center; color: #666; font-size: 0.9em; margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìö Vocabulary Builder ËØçÊ±áÂ≠¶‰π†</h1>
        <p class="subtitle">H·ªçc t·ª´ v·ª±ng theo ch·ªß ƒë·ªÅ v·ªõi SRS</p>
        
        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value new" id="stat-new">0</div>
                <div class="stat-label">M·ªõi</div>
            </div>
            <div class="stat-item">
                <div class="stat-value learning" id="stat-learning">0</div>
                <div class="stat-label">ƒêang h·ªçc</div>
            </div>
            <div class="stat-item">
                <div class="stat-value review" id="stat-review">0</div>
                <div class="stat-label">√în t·∫≠p</div>
            </div>
            <div class="stat-item">
                <div class="stat-value mastered" id="stat-mastered">0</div>
                <div class="stat-label">Th√†nh th·∫°o</div>
            </div>
        </div>
        
        <!-- Topics -->
        <div class="card">
            <h3 style="margin-bottom:15px;">üìÇ Ch·ªçn ch·ªß ƒë·ªÅ</h3>
            <div class="topics-grid" id="topics-grid"></div>
        </div>
        
        <!-- Mode Tabs -->
        <div class="mode-tabs">
            <button class="mode-tab active" data-mode="learn">üìñ H·ªçc m·ªõi <span class="count" id="learn-count">0</span></button>
            <button class="mode-tab" data-mode="review">üîÑ √în t·∫≠p <span class="count" id="review-count">0</span></button>
            <button class="mode-tab" data-mode="browse">üìã Danh s√°ch</button>
        </div>
        
        <!-- Learn/Review Mode -->
        <div id="study-area" class="card">
            <div class="session-progress">
                <span class="progress-text" id="session-text">0/0</span>
                <div class="progress-bar">
                    <div class="progress-fill" id="session-fill" style="width:0%"></div>
                </div>
            </div>
            
            <div class="flashcard-container" style="margin-top:20px;">
                <div class="flashcard" id="flashcard" onclick="flipCard()">
                    <div class="flashcard-face flashcard-front">
                        <span class="card-level level-new" id="card-level">M·ªõi</span>
                        <button class="card-audio" onclick="event.stopPropagation();speakWord()">üîä</button>
                        <div class="card-hanzi" id="card-hanzi">‰Ω†Â•Ω</div>
                        <div class="card-pinyin" id="card-pinyin">n«ê h«éo</div>
                    </div>
                    <div class="flashcard-face flashcard-back">
                        <button class="card-audio" onclick="event.stopPropagation();speakWord()">üîä</button>
                        <div class="card-hanzi" id="card-hanzi-back">‰Ω†Â•Ω</div>
                        <div class="card-meaning" id="card-meaning">Xin ch√†o</div>
                        <div class="card-example" id="card-example">
                            <div class="example-zh">‰Ω†Â•ΩÔºåÊàëÊòØÂ∞èÊòé„ÄÇ</div>
                            <div class="example-vi">Xin ch√†o, t√¥i l√† Ti·ªÉu Minh.</div>
                        </div>
                    </div>
                </div>
            </div>
            <p class="flip-hint">üëÜ Click ƒë·ªÉ l·∫≠t th·∫ª</p>
            
            <div class="srs-buttons" id="srs-buttons" style="display:none;margin-top:20px;">
                <button class="srs-btn srs-again" onclick="rateCard(0)">
                    ‚ùå Qu√™n<span class="interval">&lt;1 ph√∫t</span>
                </button>
                <button class="srs-btn srs-hard" onclick="rateCard(1)">
                    üòì Kh√≥<span class="interval" id="int-hard">10 ph√∫t</span>
                </button>
                <button class="srs-btn srs-good" onclick="rateCard(2)">
                    üëç T·ªët<span class="interval" id="int-good">1 ng√†y</span>
                </button>
                <button class="srs-btn srs-easy" onclick="rateCard(3)">
                    üéØ D·ªÖ<span class="interval" id="int-easy">4 ng√†y</span>
                </button>
            </div>
        </div>
        
        <!-- Browse Mode -->
        <div id="browse-area" class="card" style="display:none;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:15px;">
                <h3>üìã Danh s√°ch t·ª´ v·ª±ng</h3>
                <select id="filter-level" style="padding:8px 15px;border-radius:8px;background:#333;color:#fff;border:none;">
                    <option value="all">T·∫•t c·∫£</option>
                    <option value="new">M·ªõi</option>
                    <option value="learning">ƒêang h·ªçc</option>
                    <option value="review">√în t·∫≠p</option>
                    <option value="mastered">Th√†nh th·∫°o</option>
                </select>
            </div>
            <div class="word-list" id="word-list"></div>
        </div>
        
        <!-- Empty State -->
        <div id="empty-state" class="card" style="display:none;">
            <div class="empty-state">
                <div class="empty-icon">üéâ</div>
                <h3>Ho√†n th√†nh!</h3>
                <p style="margin:10px 0 20px;">B·∫°n ƒë√£ h·ªçc h·∫øt t·ª´ m·ªõi trong ch·ªß ƒë·ªÅ n√†y</p>
                <button class="btn btn-primary" onclick="switchMode('review')">üîÑ √în t·∫≠p ngay</button>
            </div>
        </div>
    </div>

    <script>
        // ============ VOCABULARY DATA ============
        const TOPICS = {
            greetings: {
                name: 'Ch√†o h·ªèi', icon: 'üëã',
                words: [
                    { hanzi: '‰Ω†Â•Ω', pinyin: 'n«ê h«éo', meaning: 'Xin ch√†o', example: '‰Ω†Â•ΩÔºåÊàëÊòØÂ∞èÊòé„ÄÇ', exampleVi: 'Xin ch√†o, t√¥i l√† Ti·ªÉu Minh.' },
                    { hanzi: 'Ë∞¢Ë∞¢', pinyin: 'xi√® xie', meaning: 'C·∫£m ∆°n', example: 'Ë∞¢Ë∞¢‰Ω†ÁöÑÂ∏ÆÂä©„ÄÇ', exampleVi: 'C·∫£m ∆°n s·ª± gi√∫p ƒë·ª° c·ªßa b·∫°n.' },
                    { hanzi: 'ÂÜçËßÅ', pinyin: 'z√†i ji√†n', meaning: 'T·∫°m bi·ªát', example: 'ÊòéÂ§©ËßÅÔºåÂÜçËßÅÔºÅ', exampleVi: 'Mai g·∫∑p, t·∫°m bi·ªát!' },
                    { hanzi: 'ÂØπ‰∏çËµ∑', pinyin: 'du√¨ bu q«ê', meaning: 'Xin l·ªói', example: 'ÂØπ‰∏çËµ∑ÔºåÊàëËøüÂà∞‰∫Ü„ÄÇ', exampleVi: 'Xin l·ªói, t√¥i ƒë·∫øn mu·ªôn.' },
                    { hanzi: 'Ê≤°ÂÖ≥Á≥ª', pinyin: 'm√©i guƒÅn xi', meaning: 'Kh√¥ng sao', example: 'Ê≤°ÂÖ≥Á≥ªÔºåÂà´ÊãÖÂøÉ„ÄÇ', exampleVi: 'Kh√¥ng sao, ƒë·ª´ng lo.' },
                    { hanzi: 'ËØ∑', pinyin: 'q«êng', meaning: 'Xin m·ªùi/L√†m ∆°n', example: 'ËØ∑Âùê„ÄÇ', exampleVi: 'Xin m·ªùi ng·ªìi.' },
                    { hanzi: '‰∏çÂÆ¢Ê∞î', pinyin: 'b√∫ k√® qi', meaning: 'Kh√¥ng c√≥ g√¨', example: '‰∏çÂÆ¢Ê∞îÔºåÂ∫îËØ•ÁöÑ„ÄÇ', exampleVi: 'Kh√¥ng c√≥ g√¨, ƒë√°ng l·∫Ω ph·∫£i v·∫≠y.' },
                    { hanzi: 'Êó©‰∏äÂ•Ω', pinyin: 'z«éo shang h«éo', meaning: 'Ch√†o bu·ªïi s√°ng', example: 'Êó©‰∏äÂ•ΩÔºå‰ªäÂ§©Â§©Ê∞îÁúüÂ•ΩÔºÅ', exampleVi: 'Ch√†o bu·ªïi s√°ng, h√¥m nay th·ªùi ti·∫øt ƒë·∫πp qu√°!' },
                ]
            },
            numbers: {
                name: 'S·ªë ƒë·∫øm', icon: 'üî¢',
                words: [
                    { hanzi: '‰∏Ä', pinyin: 'yƒ´', meaning: 'M·ªôt (1)', example: 'ÊàëÊúâ‰∏ÄÊú¨‰π¶„ÄÇ', exampleVi: 'T√¥i c√≥ m·ªôt quy·ªÉn s√°ch.' },
                    { hanzi: '‰∫å', pinyin: '√®r', meaning: 'Hai (2)', example: '‰∫åÂä†‰∫åÁ≠â‰∫éÂõõ„ÄÇ', exampleVi: 'Hai c·ªông hai b·∫±ng b·ªën.' },
                    { hanzi: '‰∏â', pinyin: 'sƒÅn', meaning: 'Ba (3)', example: '‰∏â‰∏™‰∫∫', exampleVi: 'Ba ng∆∞·ªùi' },
                    { hanzi: 'Âõõ', pinyin: 's√¨', meaning: 'B·ªën (4)', example: 'ÂõõÂ≠£', exampleVi: 'B·ªën m√πa' },
                    { hanzi: '‰∫î', pinyin: 'w«î', meaning: 'NƒÉm (5)', example: '‰∫îÈ¢úÂÖ≠Ëâ≤', exampleVi: 'Ng≈© s·∫Øc l·ª•c m√†u' },
                    { hanzi: 'ÂÖ≠', pinyin: 'li√π', meaning: 'S√°u (6)', example: 'ÂÖ≠ÁÇπÈíü', exampleVi: 'S√°u gi·ªù' },
                    { hanzi: '‰∏É', pinyin: 'qƒ´', meaning: 'B·∫£y (7)', example: '‰∏ÄÂë®‰∏ÉÂ§©', exampleVi: 'M·ªôt tu·∫ßn b·∫£y ng√†y' },
                    { hanzi: 'ÂÖ´', pinyin: 'bƒÅ', meaning: 'T√°m (8)', example: 'ÂÖ´Êúà', exampleVi: 'Th√°ng t√°m' },
                    { hanzi: '‰πù', pinyin: 'ji«î', meaning: 'Ch√≠n (9)', example: '‰πù‰πù‰πòÊ≥ïË°®', exampleVi: 'B·∫£ng c·ª≠u ch∆∞∆°ng' },
                    { hanzi: 'ÂçÅ', pinyin: 'sh√≠', meaning: 'M∆∞·ªùi (10)', example: 'ÂçÅÂÖ®ÂçÅÁæé', exampleVi: 'Th·∫≠p to√†n th·∫≠p m·ªπ' },
                ]
            },
            family: {
                name: 'Gia ƒë√¨nh', icon: 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
                words: [
                    { hanzi: 'Áà∏Áà∏', pinyin: 'b√† ba', meaning: 'B·ªë', example: 'ÊàëÁà∏Áà∏ÊòØÂåªÁîü„ÄÇ', exampleVi: 'B·ªë t√¥i l√† b√°c sƒ©.' },
                    { hanzi: 'Â¶àÂ¶à', pinyin: 'mƒÅ ma', meaning: 'M·∫π', example: 'Â¶àÂ¶àÂÅöÁöÑËèúÂæàÂ•ΩÂêÉ„ÄÇ', exampleVi: 'M√≥n ƒÉn m·∫π n·∫•u r·∫•t ngon.' },
                    { hanzi: 'Âì•Âì•', pinyin: 'gƒì ge', meaning: 'Anh trai', example: 'ÊàëÂì•Âì•ÊØîÊàëÂ§ß‰∏âÂ≤Å„ÄÇ', exampleVi: 'Anh trai t√¥i l·ªõn h∆°n t√¥i 3 tu·ªïi.' },
                    { hanzi: 'ÂßêÂßê', pinyin: 'jiƒõ jie', meaning: 'Ch·ªã g√°i', example: 'ÂßêÂßêÂú®Â§ßÂ≠¶Â≠¶‰π†„ÄÇ', exampleVi: 'Ch·ªã g√°i ƒëang h·ªçc ƒë·∫°i h·ªçc.' },
                    { hanzi: 'ÂºüÂºü', pinyin: 'd√¨ di', meaning: 'Em trai', example: 'ÂºüÂºüÂñúÊ¨¢Ë∏¢Ë∂≥ÁêÉ„ÄÇ', exampleVi: 'Em trai th√≠ch ƒë√° b√≥ng.' },
                    { hanzi: 'Â¶πÂ¶π', pinyin: 'm√®i mei', meaning: 'Em g√°i', example: 'Â¶πÂ¶π‰ªäÂπ¥‰∫îÂ≤Å„ÄÇ', exampleVi: 'Em g√°i nƒÉm nay 5 tu·ªïi.' },
                    { hanzi: 'Áà∑Áà∑', pinyin: 'y√© ye', meaning: '√îng n·ªôi', example: 'Áà∑Áà∑ÂñúÊ¨¢‰∏ãÊ£ã„ÄÇ', exampleVi: '√îng n·ªôi th√≠ch ch∆°i c·ªù.' },
                    { hanzi: 'Â•∂Â•∂', pinyin: 'n«éi nai', meaning: 'B√† n·ªôi', example: 'Â•∂Â•∂ÁªôÊàëËÆ≤ÊïÖ‰∫ã„ÄÇ', exampleVi: 'B√† n·ªôi k·ªÉ chuy·ªán cho t√¥i.' },
                ]
            },
            food: {
                name: 'ƒê·ªì ƒÉn', icon: 'üçú',
                words: [
                    { hanzi: 'Á±≥È•≠', pinyin: 'm«ê f√†n', meaning: 'C∆°m', example: 'ÊàëÊØèÂ§©ÂêÉÁ±≥È•≠„ÄÇ', exampleVi: 'T√¥i ƒÉn c∆°m m·ªói ng√†y.' },
                    { hanzi: 'Èù¢Êù°', pinyin: 'mi√†n ti√°o', meaning: 'M√¨', example: 'ËøôÁ¢óÈù¢Êù°ÂæàÂ•ΩÂêÉ„ÄÇ', exampleVi: 'B√°t m√¨ n√†y r·∫•t ngon.' },
                    { hanzi: 'È•∫Â≠ê', pinyin: 'ji«éo zi', meaning: 'S·ªßi c·∫£o', example: 'ËøáÂπ¥ÂêÉÈ•∫Â≠ê„ÄÇ', exampleVi: 'T·∫øt ƒÉn s·ªßi c·∫£o.' },
                    { hanzi: 'ÂåÖÂ≠ê', pinyin: 'bƒÅo zi', meaning: 'B√°nh bao', example: 'Êó©È§êÂêÉÂåÖÂ≠ê„ÄÇ', exampleVi: 'B·ªØa s√°ng ƒÉn b√°nh bao.' },
                    { hanzi: 'È∏°Ëõã', pinyin: 'jƒ´ d√†n', meaning: 'Tr·ª©ng g√†', example: 'ÊàëÂñúÊ¨¢ÂêÉÁÇíÈ∏°Ëõã„ÄÇ', exampleVi: 'T√¥i th√≠ch ƒÉn tr·ª©ng chi√™n.' },
                    { hanzi: 'ÁâõËÇâ', pinyin: 'ni√∫ r√≤u', meaning: 'Th·ªãt b√≤', example: 'ÁâõËÇâÈù¢ÂæàÈ¶ô„ÄÇ', exampleVi: 'M√¨ b√≤ r·∫•t th∆°m.' },
                    { hanzi: 'Ëî¨Ëèú', pinyin: 'sh≈´ c√†i', meaning: 'Rau c·ªß', example: 'Â§öÂêÉËî¨ËèúÂØπË∫´‰ΩìÂ•Ω„ÄÇ', exampleVi: 'ƒÇn nhi·ªÅu rau t·ªët cho s·ª©c kh·ªèe.' },
                    { hanzi: 'Ê∞¥Êûú', pinyin: 'shu«ê gu«í', meaning: 'Tr√°i c√¢y', example: 'ÊàëÂñúÊ¨¢ÂêÉÊ∞¥Êûú„ÄÇ', exampleVi: 'T√¥i th√≠ch ƒÉn tr√°i c√¢y.' },
                ]
            },
            time: {
                name: 'Th·ªùi gian', icon: '‚è∞',
                words: [
                    { hanzi: '‰ªäÂ§©', pinyin: 'jƒ´n tiƒÅn', meaning: 'H√¥m nay', example: '‰ªäÂ§©ÊòØÊòüÊúü‰∏Ä„ÄÇ', exampleVi: 'H√¥m nay l√† th·ª© hai.' },
                    { hanzi: 'ÊòéÂ§©', pinyin: 'm√≠ng tiƒÅn', meaning: 'Ng√†y mai', example: 'ÊòéÂ§©Êàë‰ª¨ÂéªÊóÖÊ∏∏„ÄÇ', exampleVi: 'Ng√†y mai ch√∫ng ta ƒëi du l·ªãch.' },
                    { hanzi: 'Êò®Â§©', pinyin: 'zu√≥ tiƒÅn', meaning: 'H√¥m qua', example: 'Êò®Â§©‰∏ãÈõ®‰∫Ü„ÄÇ', exampleVi: 'H√¥m qua tr·ªùi m∆∞a.' },
                    { hanzi: 'Áé∞Âú®', pinyin: 'xi√†n z√†i', meaning: 'B√¢y gi·ªù', example: 'Áé∞Âú®Âá†ÁÇπ‰∫ÜÔºü', exampleVi: 'B√¢y gi·ªù m·∫•y gi·ªù r·ªìi?' },
                    { hanzi: 'Êó©‰∏ä', pinyin: 'z«éo shang', meaning: 'Bu·ªïi s√°ng', example: 'Êó©‰∏äÂ•ΩÔºÅ', exampleVi: 'Ch√†o bu·ªïi s√°ng!' },
                    { hanzi: '‰∏≠Âçà', pinyin: 'zh≈çng w«î', meaning: 'Bu·ªïi tr∆∞a', example: '‰∏≠ÂçàÂêÉ‰ªÄ‰πàÔºü', exampleVi: 'Tr∆∞a ƒÉn g√¨?' },
                    { hanzi: 'Êôö‰∏ä', pinyin: 'w«én shang', meaning: 'Bu·ªïi t·ªëi', example: 'Êôö‰∏äÊàëÁúãÁîµËßÜ„ÄÇ', exampleVi: 'T·ªëi t√¥i xem TV.' },
                    { hanzi: 'ÊòüÊúü', pinyin: 'xƒ´ng qƒ´', meaning: 'Tu·∫ßn', example: '‰∏Ä‰∏™ÊòüÊúüÊúâ‰∏ÉÂ§©„ÄÇ', exampleVi: 'M·ªôt tu·∫ßn c√≥ b·∫£y ng√†y.' },
                ]
            },
            places: {
                name: 'ƒê·ªãa ƒëi·ªÉm', icon: 'üè¢',
                words: [
                    { hanzi: 'Â≠¶Ê†°', pinyin: 'xu√© xi√†o', meaning: 'Tr∆∞·ªùng h·ªçc', example: 'ÊàëÂú®Â≠¶Ê†°Â≠¶‰π†„ÄÇ', exampleVi: 'T√¥i h·ªçc ·ªü tr∆∞·ªùng.' },
                    { hanzi: 'ÂåªÈô¢', pinyin: 'yƒ´ yu√†n', meaning: 'B·ªánh vi·ªán', example: '‰ªñÂú®ÂåªÈô¢Â∑•‰Ωú„ÄÇ', exampleVi: 'Anh ·∫•y l√†m vi·ªác ·ªü b·ªánh vi·ªán.' },
                    { hanzi: 'Èì∂Ë°å', pinyin: 'y√≠n h√°ng', meaning: 'Ng√¢n h√†ng', example: 'Èì∂Ë°åÂá†ÁÇπÂºÄÈó®Ôºü', exampleVi: 'Ng√¢n h√†ng m·∫•y gi·ªù m·ªü c·ª≠a?' },
                    { hanzi: 'Ë∂ÖÂ∏Ç', pinyin: 'chƒÅo sh√¨', meaning: 'Si√™u th·ªã', example: 'ÊàëÂéªË∂ÖÂ∏Ç‰π∞‰∏úË•ø„ÄÇ', exampleVi: 'T√¥i ƒëi si√™u th·ªã mua ƒë·ªì.' },
                    { hanzi: 'È•≠Â∫ó', pinyin: 'f√†n di√†n', meaning: 'Nh√† h√†ng', example: 'ËøôÂÆ∂È•≠Â∫óÂæàÊúâÂêç„ÄÇ', exampleVi: 'Nh√† h√†ng n√†y r·∫•t n·ªïi ti·∫øng.' },
                    { hanzi: 'Êú∫Âú∫', pinyin: 'jƒ´ ch«éng', meaning: 'S√¢n bay', example: 'Êú∫Âú∫Á¶ªËøôÂÑøÂæàËøú„ÄÇ', exampleVi: 'S√¢n bay c√°ch ƒë√¢y r·∫•t xa.' },
                    { hanzi: 'ÁÅ´ËΩ¶Á´ô', pinyin: 'hu«í chƒì zh√†n', meaning: 'Ga t√†u', example: 'ÁÅ´ËΩ¶Á´ôÂú®Âì™ÂÑøÔºü', exampleVi: 'Ga t√†u ·ªü ƒë√¢u?' },
                    { hanzi: 'ÂÖ¨Âõ≠', pinyin: 'g≈çng yu√°n', meaning: 'C√¥ng vi√™n', example: 'Âë®Êú´ÊàëÂéªÂÖ¨Âõ≠Êï£Ê≠•„ÄÇ', exampleVi: 'Cu·ªëi tu·∫ßn t√¥i ƒëi d·∫°o c√¥ng vi√™n.' },
                ]
            },
            verbs: {
                name: 'ƒê·ªông t·ª´', icon: 'üèÉ',
                words: [
                    { hanzi: 'ÂêÉ', pinyin: 'chƒ´', meaning: 'ƒÇn', example: 'ÊàëÂêÉÊó©È•≠‰∫Ü„ÄÇ', exampleVi: 'T√¥i ƒë√£ ƒÉn s√°ng.' },
                    { hanzi: 'Âñù', pinyin: 'hƒì', meaning: 'U·ªëng', example: '‰Ω†Âñù‰ªÄ‰πàÔºü', exampleVi: 'B·∫°n u·ªëng g√¨?' },
                    { hanzi: 'Áúã', pinyin: 'k√†n', meaning: 'Xem/Nh√¨n', example: 'ÊàëÂú®Áúã‰π¶„ÄÇ', exampleVi: 'T√¥i ƒëang ƒë·ªçc s√°ch.' },
                    { hanzi: 'Âê¨', pinyin: 'tƒ´ng', meaning: 'Nghe', example: 'ÊàëÂñúÊ¨¢Âê¨Èü≥‰πê„ÄÇ', exampleVi: 'T√¥i th√≠ch nghe nh·∫°c.' },
                    { hanzi: 'ËØ¥', pinyin: 'shu≈ç', meaning: 'N√≥i', example: '‰Ω†‰ºöËØ¥‰∏≠ÊñáÂêóÔºü', exampleVi: 'B·∫°n bi·∫øt n√≥i ti·∫øng Trung kh√¥ng?' },
                    { hanzi: 'ÂÜô', pinyin: 'xiƒõ', meaning: 'Vi·∫øt', example: 'ÊàëÂú®ÂÜô‰Ωú‰∏ö„ÄÇ', exampleVi: 'T√¥i ƒëang l√†m b√†i t·∫≠p.' },
                    { hanzi: 'Â≠¶‰π†', pinyin: 'xu√© x√≠', meaning: 'H·ªçc t·∫≠p', example: 'ÊàëÂ≠¶‰π†‰∏≠Êñá„ÄÇ', exampleVi: 'T√¥i h·ªçc ti·∫øng Trung.' },
                    { hanzi: 'Â∑•‰Ωú', pinyin: 'g≈çng zu√≤', meaning: 'L√†m vi·ªác', example: '‰ªñÂú®ÂÖ¨Âè∏Â∑•‰Ωú„ÄÇ', exampleVi: 'Anh ·∫•y l√†m vi·ªác ·ªü c√¥ng ty.' },
                ]
            },
            adjectives: {
                name: 'T√≠nh t·ª´', icon: 'üåà',
                words: [
                    { hanzi: 'Â§ß', pinyin: 'd√†', meaning: 'To/L·ªõn', example: 'Ëøô‰∏™ÊàøÈó¥ÂæàÂ§ß„ÄÇ', exampleVi: 'CƒÉn ph√≤ng n√†y r·∫•t l·ªõn.' },
                    { hanzi: 'Â∞è', pinyin: 'xi«éo', meaning: 'Nh·ªè', example: 'ÊàëÊúâ‰∏ÄÂè™Â∞èÁãó„ÄÇ', exampleVi: 'T√¥i c√≥ m·ªôt con ch√≥ nh·ªè.' },
                    { hanzi: 'Â•Ω', pinyin: 'h«éo', meaning: 'T·ªët', example: '‰ªäÂ§©Â§©Ê∞îÂæàÂ•Ω„ÄÇ', exampleVi: 'H√¥m nay th·ªùi ti·∫øt r·∫•t t·ªët.' },
                    { hanzi: 'Âùè', pinyin: 'hu√†i', meaning: 'X·∫•u/H·ªèng', example: 'Ëøô‰∏™ÊâãÊú∫Âùè‰∫Ü„ÄÇ', exampleVi: 'ƒêi·ªán tho·∫°i n√†y h·ªèng r·ªìi.' },
                    { hanzi: 'Âø´', pinyin: 'ku√†i', meaning: 'Nhanh', example: '‰ªñË∑ëÂæóÂæàÂø´„ÄÇ', exampleVi: 'Anh ·∫•y ch·∫°y r·∫•t nhanh.' },
                    { hanzi: 'ÊÖ¢', pinyin: 'm√†n', meaning: 'Ch·∫≠m', example: 'ËØ∑ËØ¥ÊÖ¢‰∏ÄÁÇπ„ÄÇ', exampleVi: 'Xin n√≥i ch·∫≠m m·ªôt ch√∫t.' },
                    { hanzi: 'ÁÉ≠', pinyin: 'r√®', meaning: 'N√≥ng', example: '‰ªäÂ§©ÂæàÁÉ≠„ÄÇ', exampleVi: 'H√¥m nay r·∫•t n√≥ng.' },
                    { hanzi: 'ÂÜ∑', pinyin: 'lƒõng', meaning: 'L·∫°nh', example: 'ÂÜ¨Â§©ÂæàÂÜ∑„ÄÇ', exampleVi: 'M√πa ƒë√¥ng r·∫•t l·∫°nh.' },
                ]
            }
        };

        // ============ SRS ALGORITHM ============
        const SRS_INTERVALS = [
            1,          // Again: 1 minute
            10,         // Hard: 10 minutes
            1440,       // Good: 1 day
            5760,       // Easy: 4 days
        ];
        
        const LEVEL_THRESHOLDS = {
            new: 0,
            learning: 1,
            review: 3,
            mastered: 5
        };
        
        function getWordLevel(word) {
            const reps = word.reps || 0;
            if (reps >= LEVEL_THRESHOLDS.mastered) return 'mastered';
            if (reps >= LEVEL_THRESHOLDS.review) return 'review';
            if (reps >= LEVEL_THRESHOLDS.learning) return 'learning';
            return 'new';
        }
        
        function calculateNextReview(word, rating) {
            const now = Date.now();
            let interval;
            
            if (rating === 0) {
                // Again - reset
                word.reps = Math.max(0, (word.reps || 0) - 1);
                interval = SRS_INTERVALS[0];
            } else {
                word.reps = (word.reps || 0) + 1;
                const baseInterval = SRS_INTERVALS[rating];
                const multiplier = Math.pow(2.5, Math.max(0, word.reps - 1));
                interval = Math.min(baseInterval * multiplier, 43200); // Max 30 days
            }
            
            word.nextReview = now + interval * 60 * 1000;
            word.lastReview = now;
            return word;
        }
        
        function formatInterval(minutes) {
            if (minutes < 60) return `${minutes} ph√∫t`;
            if (minutes < 1440) return `${Math.round(minutes/60)} gi·ªù`;
            return `${Math.round(minutes/1440)} ng√†y`;
        }
        
        // ============ STATE ============
        const state = {
            currentTopic: 'greetings',
            mode: 'learn',
            queue: [],
            currentIndex: 0,
            flipped: false,
            progress: loadProgress()
        };
        
        function loadProgress() {
            try {
                return JSON.parse(localStorage.getItem('polybiz_vocab') || '{}');
            } catch { return {}; }
        }
        
        function saveProgress() {
            localStorage.setItem('polybiz_vocab', JSON.stringify(state.progress));
        }
        
        function getWordProgress(topicId, wordIndex) {
            const key = `${topicId}-${wordIndex}`;
            return state.progress[key] || { reps: 0, nextReview: 0, lastReview: 0 };
        }
        
        function setWordProgress(topicId, wordIndex, data) {
            const key = `${topicId}-${wordIndex}`;
            state.progress[key] = data;
            saveProgress();
        }
        
        // ============ UI ============
        function renderTopics() {
            const grid = document.getElementById('topics-grid');
            grid.innerHTML = Object.entries(TOPICS).map(([id, topic]) => {
                const words = topic.words;
                const mastered = words.filter((_, i) => getWordLevel(getWordProgress(id, i)) === 'mastered').length;
                const progress = Math.round(mastered / words.length * 100);
                
                return `
                    <div class="topic-card ${state.currentTopic === id ? 'selected' : ''}" 
                         onclick="selectTopic('${id}')">
                        <div class="topic-icon">${topic.icon}</div>
                        <div class="topic-name">${topic.name}</div>
                        <div class="topic-count">${words.length} t·ª´</div>
                        <div class="topic-progress">
                            <div class="topic-progress-fill" style="width:${progress}%"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function selectTopic(topicId) {
            state.currentTopic = topicId;
            renderTopics();
            buildQueue();
            updateStats();
        }
        
        function switchMode(mode) {
            state.mode = mode;
            document.querySelectorAll('.mode-tab').forEach(t => t.classList.remove('active'));
            document.querySelector(`[data-mode="${mode}"]`).classList.add('active');
            
            document.getElementById('study-area').style.display = mode !== 'browse' ? 'block' : 'none';
            document.getElementById('browse-area').style.display = mode === 'browse' ? 'block' : 'none';
            document.getElementById('empty-state').style.display = 'none';
            
            if (mode === 'browse') {
                renderWordList();
            } else {
                buildQueue();
            }
        }
        
        function buildQueue() {
            const topic = TOPICS[state.currentTopic];
            const now = Date.now();
            
            state.queue = topic.words.map((word, index) => {
                const progress = getWordProgress(state.currentTopic, index);
                return { ...word, index, ...progress };
            });
            
            if (state.mode === 'learn') {
                // New words first, then due reviews
                state.queue = state.queue.filter(w => getWordLevel(w) === 'new' || w.nextReview <= now);
                state.queue.sort((a, b) => {
                    const aNew = getWordLevel(a) === 'new';
                    const bNew = getWordLevel(b) === 'new';
                    if (aNew !== bNew) return aNew ? -1 : 1;
                    return (a.nextReview || 0) - (b.nextReview || 0);
                });
            } else {
                // Review mode - only due cards
                state.queue = state.queue.filter(w => w.nextReview > 0 && w.nextReview <= now);
                state.queue.sort((a, b) => (a.nextReview || 0) - (b.nextReview || 0));
            }
            
            state.currentIndex = 0;
            state.flipped = false;
            
            if (state.queue.length === 0) {
                document.getElementById('study-area').style.display = 'none';
                document.getElementById('empty-state').style.display = 'block';
            } else {
                document.getElementById('study-area').style.display = 'block';
                document.getElementById('empty-state').style.display = 'none';
                renderCard();
            }
            
            updateCounts();
        }
        
        function renderCard() {
            if (state.currentIndex >= state.queue.length) {
                document.getElementById('study-area').style.display = 'none';
                document.getElementById('empty-state').style.display = 'block';
                return;
            }
            
            const word = state.queue[state.currentIndex];
            const level = getWordLevel(word);
            
            document.getElementById('card-hanzi').textContent = word.hanzi;
            document.getElementById('card-hanzi-back').textContent = word.hanzi;
            document.getElementById('card-pinyin').textContent = word.pinyin;
            document.getElementById('card-meaning').textContent = word.meaning;
            document.getElementById('card-example').innerHTML = `
                <div class="example-zh">${word.example}</div>
                <div class="example-vi">${word.exampleVi}</div>
            `;
            
            const levelEl = document.getElementById('card-level');
            levelEl.className = `card-level level-${level}`;
            levelEl.textContent = { new: 'M·ªõi', learning: 'ƒêang h·ªçc', review: '√în t·∫≠p', mastered: 'Th√†nh th·∫°o' }[level];
            
            // Update intervals
            const reps = word.reps || 0;
            document.getElementById('int-hard').textContent = formatInterval(SRS_INTERVALS[1] * Math.pow(2.5, Math.max(0, reps)));
            document.getElementById('int-good').textContent = formatInterval(SRS_INTERVALS[2] * Math.pow(2.5, Math.max(0, reps)));
            document.getElementById('int-easy').textContent = formatInterval(SRS_INTERVALS[3] * Math.pow(2.5, Math.max(0, reps)));
            
            // Reset flip
            state.flipped = false;
            document.getElementById('flashcard').classList.remove('flipped');
            document.getElementById('srs-buttons').style.display = 'none';
            document.querySelector('.flip-hint').style.display = 'block';
            
            // Update progress
            document.getElementById('session-text').textContent = `${state.currentIndex + 1}/${state.queue.length}`;
            document.getElementById('session-fill').style.width = `${(state.currentIndex + 1) / state.queue.length * 100}%`;
        }
        
        function flipCard() {
            state.flipped = !state.flipped;
            document.getElementById('flashcard').classList.toggle('flipped', state.flipped);
            
            if (state.flipped) {
                document.getElementById('srs-buttons').style.display = 'flex';
                document.querySelector('.flip-hint').style.display = 'none';
            }
        }
        
        function rateCard(rating) {
            const word = state.queue[state.currentIndex];
            const updated = calculateNextReview({ ...word }, rating);
            setWordProgress(state.currentTopic, word.index, {
                reps: updated.reps,
                nextReview: updated.nextReview,
                lastReview: updated.lastReview
            });
            
            state.currentIndex++;
            updateStats();
            updateCounts();
            renderCard();
        }
        
        function speakWord() {
            const word = state.queue[state.currentIndex];
            if (word) {
                const utterance = new SpeechSynthesisUtterance(word.hanzi);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }
        
        function updateStats() {
            let newCount = 0, learningCount = 0, reviewCount = 0, masteredCount = 0;
            
            Object.entries(TOPICS).forEach(([topicId, topic]) => {
                topic.words.forEach((_, i) => {
                    const level = getWordLevel(getWordProgress(topicId, i));
                    if (level === 'new') newCount++;
                    else if (level === 'learning') learningCount++;
                    else if (level === 'review') reviewCount++;
                    else masteredCount++;
                });
            });
            
            document.getElementById('stat-new').textContent = newCount;
            document.getElementById('stat-learning').textContent = learningCount;
            document.getElementById('stat-review').textContent = reviewCount;
            document.getElementById('stat-mastered').textContent = masteredCount;
        }
        
        function updateCounts() {
            const topic = TOPICS[state.currentTopic];
            const now = Date.now();
            
            let learnCount = 0, reviewCount = 0;
            topic.words.forEach((_, i) => {
                const progress = getWordProgress(state.currentTopic, i);
                const level = getWordLevel(progress);
                if (level === 'new') learnCount++;
                else if (progress.nextReview <= now) reviewCount++;
            });
            
            document.getElementById('learn-count').textContent = learnCount;
            document.getElementById('review-count').textContent = reviewCount;
        }
        
        function renderWordList() {
            const topic = TOPICS[state.currentTopic];
            const filter = document.getElementById('filter-level').value;
            
            const html = topic.words.map((word, i) => {
                const progress = getWordProgress(state.currentTopic, i);
                const level = getWordLevel(progress);
                
                if (filter !== 'all' && level !== filter) return '';
                
                const levelText = { new: 'M·ªõi', learning: 'ƒêang h·ªçc', review: '√în t·∫≠p', mastered: 'Th√†nh th·∫°o' }[level];
                
                return `
                    <div class="word-item" onclick="previewWord(${i})">
                        <div class="word-hanzi">${word.hanzi}</div>
                        <div class="word-info">
                            <div class="word-pinyin">${word.pinyin}</div>
                            <div class="word-meaning">${word.meaning}</div>
                        </div>
                        <span class="word-level level-${level}">${levelText}</span>
                    </div>
                `;
            }).join('');
            
            document.getElementById('word-list').innerHTML = html || '<div class="empty-state"><p>Kh√¥ng c√≥ t·ª´ n√†o</p></div>';
        }
        
        function previewWord(index) {
            const word = TOPICS[state.currentTopic].words[index];
            const utterance = new SpeechSynthesisUtterance(word.hanzi);
            utterance.lang = 'zh-CN';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }
        
        // ============ INIT ============
        document.querySelectorAll('.mode-tab').forEach(tab => {
            tab.addEventListener('click', () => switchMode(tab.dataset.mode));
        });
        
        document.getElementById('filter-level').addEventListener('change', renderWordList);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            if (e.code === 'Space') {
                e.preventDefault();
                flipCard();
            } else if (state.flipped) {
                if (e.key === '1') rateCard(0);
                else if (e.key === '2') rateCard(1);
                else if (e.key === '3') rateCard(2);
                else if (e.key === '4') rateCard(3);
            }
        });
        
        renderTopics();
        updateStats();
        buildQueue();
    </script>
</body>
</html>
