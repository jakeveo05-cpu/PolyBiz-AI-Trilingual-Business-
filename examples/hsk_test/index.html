<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyBiz AI - HSK Test Simulator Ê±âËØ≠Ê∞¥Âπ≥ËÄÉËØï</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh; color: #fff; padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }
        
        .card {
            background: rgba(255,255,255,0.05); border-radius: 15px;
            padding: 25px; margin-bottom: 20px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        /* Level Selector */
        .level-selector {
            display: flex; gap: 15px; justify-content: center; margin-bottom: 30px;
        }
        .level-card {
            padding: 25px 40px; background: rgba(255,255,255,0.05);
            border: 2px solid #444; border-radius: 15px;
            cursor: pointer; transition: all 0.3s; text-align: center;
        }
        .level-card:hover { border-color: #60a5fa; transform: translateY(-3px); }
        .level-card.selected { border-color: #3b82f6; background: rgba(59,130,246,0.2); }
        .level-name { font-size: 1.5em; font-weight: bold; margin-bottom: 5px; }
        .level-info { color: #888; font-size: 0.9em; }

        /* Test Header */
        .test-header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px; background: rgba(0,0,0,0.3);
            border-radius: 10px; margin-bottom: 20px;
        }
        .test-info { display: flex; gap: 20px; }
        .test-info-item { text-align: center; }
        .test-info-value { font-size: 1.3em; font-weight: bold; color: #60a5fa; }
        .test-info-label { font-size: 0.8em; color: #888; }
        .test-timer {
            font-size: 1.5em; font-weight: bold;
            padding: 10px 20px; background: rgba(239,68,68,0.2);
            border-radius: 10px; color: #ef4444;
        }
        .test-timer.warning { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
        
        /* Progress */
        .progress-bar {
            height: 8px; background: rgba(255,255,255,0.1);
            border-radius: 4px; margin-bottom: 20px;
        }
        .progress-fill {
            height: 100%; background: linear-gradient(90deg, #3b82f6, #22c55e);
            border-radius: 4px; transition: width 0.3s;
        }
        
        /* Section Tabs */
        .section-tabs {
            display: flex; gap: 10px; margin-bottom: 20px;
        }
        .section-tab {
            flex: 1; padding: 12px; border: none; border-radius: 10px;
            background: rgba(255,255,255,0.05); color: #888;
            cursor: pointer; transition: all 0.2s; text-align: center;
        }
        .section-tab.active { background: rgba(59,130,246,0.3); color: #fff; }
        .section-tab.completed { background: rgba(34,197,94,0.2); color: #22c55e; }
        .section-tab:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Question */
        .question-card {
            background: rgba(0,0,0,0.2); border-radius: 15px;
            padding: 25px; margin-bottom: 20px;
        }
        .question-number { color: #888; margin-bottom: 10px; }
        .question-audio {
            text-align: center; margin-bottom: 20px;
        }
        .audio-btn {
            padding: 15px 40px; font-size: 1.2em;
            background: #3b82f6; border: none; border-radius: 10px;
            color: #fff; cursor: pointer; transition: all 0.2s;
        }
        .audio-btn:hover { transform: scale(1.05); }
        .audio-btn:disabled { opacity: 0.5; }
        .play-count { color: #888; margin-top: 10px; font-size: 0.9em; }
        
        .question-text {
            font-size: 1.3em; margin-bottom: 20px; line-height: 1.6;
            font-family: 'Noto Sans SC', serif;
        }
        .question-image {
            max-width: 300px; margin: 0 auto 20px;
            background: rgba(255,255,255,0.1); border-radius: 10px;
            padding: 20px; text-align: center;
        }
        
        /* Options */
        .options { display: flex; flex-direction: column; gap: 12px; }
        .option {
            padding: 15px 20px; border: 2px solid #444; border-radius: 10px;
            cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 15px;
        }
        .option:hover { border-color: #60a5fa; background: rgba(96,165,250,0.1); }
        .option.selected { border-color: #3b82f6; background: rgba(59,130,246,0.2); }
        .option.correct { border-color: #22c55e; background: rgba(34,197,94,0.2); }
        .option.wrong { border-color: #ef4444; background: rgba(239,68,68,0.2); }
        .option.disabled { pointer-events: none; }
        .option-letter {
            width: 30px; height: 30px; border-radius: 50%;
            background: rgba(255,255,255,0.1); display: flex;
            align-items: center; justify-content: center; font-weight: bold;
        }
        .option-text { flex: 1; font-size: 1.1em; }
        
        /* Navigation */
        .nav-buttons {
            display: flex; justify-content: space-between; margin-top: 20px;
        }
        .btn {
            padding: 12px 30px; border: none; border-radius: 10px;
            cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .btn-primary { background: #3b82f6; color: #fff; }
        .btn-success { background: #22c55e; color: #fff; }
        .btn-secondary { background: #6b7280; color: #fff; }
        .btn-warning { background: #f59e0b; color: #000; }
        .btn:hover { transform: scale(1.05); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Question Navigator */
        .question-nav {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            padding: 15px; background: rgba(0,0,0,0.2); border-radius: 10px;
        }
        .q-dot {
            width: 35px; height: 35px; border-radius: 8px;
            background: rgba(255,255,255,0.1); display: flex;
            align-items: center; justify-content: center;
            cursor: pointer; font-size: 0.9em; transition: all 0.2s;
        }
        .q-dot:hover { background: rgba(59,130,246,0.3); }
        .q-dot.current { background: #3b82f6; }
        .q-dot.answered { background: rgba(34,197,94,0.3); }
        .q-dot.flagged { border: 2px solid #f59e0b; }
        
        /* Results */
        .results-card {
            text-align: center; padding: 40px;
            background: rgba(0,0,0,0.3); border-radius: 20px;
        }
        .results-icon { font-size: 5em; margin-bottom: 20px; }
        .results-score { font-size: 3em; font-weight: bold; color: #60a5fa; }
        .results-label { color: #888; margin-bottom: 20px; }
        .results-breakdown {
            display: flex; justify-content: center; gap: 40px; margin: 30px 0;
        }
        .breakdown-item { text-align: center; }
        .breakdown-value { font-size: 2em; font-weight: bold; }
        .breakdown-label { color: #888; font-size: 0.9em; }
        .pass { color: #22c55e; }
        .fail { color: #ef4444; }
        
        /* Start Screen */
        .start-screen { text-align: center; padding: 40px; }
        .start-icon { font-size: 4em; margin-bottom: 20px; }
        .start-title { font-size: 1.8em; margin-bottom: 10px; }
        .start-desc { color: #888; margin-bottom: 30px; }
        .test-rules {
            text-align: left; padding: 20px;
            background: rgba(0,0,0,0.2); border-radius: 10px;
            margin-bottom: 30px;
        }
        .test-rules h4 { margin-bottom: 10px; color: #fbbf24; }
        .test-rules li { margin: 8px 0; color: #aaa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù HSK Test Simulator Ê±âËØ≠Ê∞¥Âπ≥ËÄÉËØï</h1>
        <p class="subtitle">Thi th·ª≠ HSK 1-3 v·ªõi ƒë·ªÅ thi m·∫´u</p>
        
        <!-- Level Selection -->
        <div id="level-screen">
            <div class="level-selector">
                <div class="level-card" data-level="1">
                    <div class="level-name">HSK 1</div>
                    <div class="level-info">150 t·ª´ | 40 c√¢u | 35 ph√∫t</div>
                </div>
                <div class="level-card" data-level="2">
                    <div class="level-name">HSK 2</div>
                    <div class="level-info">300 t·ª´ | 55 c√¢u | 50 ph√∫t</div>
                </div>
                <div class="level-card" data-level="3">
                    <div class="level-name">HSK 3</div>
                    <div class="level-info">600 t·ª´ | 80 c√¢u | 85 ph√∫t</div>
                </div>
            </div>
            
            <div class="card start-screen" id="start-screen" style="display:none;">
                <div class="start-icon">üìã</div>
                <div class="start-title">HSK <span id="selected-level">1</span></div>
                <div class="start-desc">B√†i thi g·ªìm <span id="test-sections">2</span> ph·∫ßn: Nghe hi·ªÉu v√† ƒê·ªçc hi·ªÉu</div>
                
                <div class="test-rules">
                    <h4>üìå Quy t·∫Øc thi:</h4>
                    <ul>
                        <li>M·ªói c√¢u h·ªèi nghe ƒë∆∞·ª£c ph√°t <strong>2 l·∫ßn</strong></li>
                        <li>Kh√¥ng ƒë∆∞·ª£c quay l·∫°i ph·∫ßn ƒë√£ ho√†n th√†nh</li>
                        <li>ƒêi·ªÉm ƒë·∫°t: <strong>120/200</strong> (60%)</li>
                        <li>Th·ªùi gian ƒë∆∞·ª£c t√≠nh ri√™ng cho t·ª´ng ph·∫ßn</li>
                    </ul>
                </div>
                
                <button class="btn btn-success" style="font-size:1.2em;padding:15px 50px;" id="btn-start-test">
                    üöÄ B·∫Øt ƒë·∫ßu thi
                </button>
            </div>
        </div>
        
        <!-- Test Screen -->
        <div id="test-screen" style="display:none;">
            <div class="test-header">
                <div class="test-info">
                    <div class="test-info-item">
                        <div class="test-info-value" id="current-section">Nghe hi·ªÉu</div>
                        <div class="test-info-label">Ph·∫ßn thi</div>
                    </div>
                    <div class="test-info-item">
                        <div class="test-info-value" id="question-progress">1/20</div>
                        <div class="test-info-label">C√¢u h·ªèi</div>
                    </div>
                </div>
                <div class="test-timer" id="test-timer">35:00</div>
            </div>
            
            <div class="progress-bar">
                <div class="progress-fill" id="progress-fill" style="width:0%"></div>
            </div>
            
            <div class="section-tabs">
                <button class="section-tab active" data-section="listening">üëÇ Nghe hi·ªÉu</button>
                <button class="section-tab" data-section="reading" disabled>üìñ ƒê·ªçc hi·ªÉu</button>
            </div>
            
            <div class="card">
                <div class="question-card" id="question-card"></div>
                
                <div class="question-nav" id="question-nav"></div>
                
                <div class="nav-buttons">
                    <button class="btn btn-secondary" id="btn-prev" disabled>‚¨ÖÔ∏è Tr∆∞·ªõc</button>
                    <button class="btn btn-warning" id="btn-flag">üö© ƒê√°nh d·∫•u</button>
                    <button class="btn btn-primary" id="btn-next">Ti·∫øp theo ‚û°Ô∏è</button>
                </div>
            </div>
        </div>
        
        <!-- Results Screen -->
        <div id="results-screen" style="display:none;">
            <div class="card results-card">
                <div class="results-icon" id="results-icon">üéâ</div>
                <div class="results-score" id="results-score">160/200</div>
                <div class="results-label">ƒêi·ªÉm s·ªë</div>
                
                <div class="results-breakdown">
                    <div class="breakdown-item">
                        <div class="breakdown-value" id="listening-score">80/100</div>
                        <div class="breakdown-label">Nghe hi·ªÉu</div>
                    </div>
                    <div class="breakdown-item">
                        <div class="breakdown-value" id="reading-score">80/100</div>
                        <div class="breakdown-label">ƒê·ªçc hi·ªÉu</div>
                    </div>
                </div>
                
                <div id="pass-status" class="pass" style="font-size:1.5em;margin-bottom:30px;">
                    ‚úÖ ƒê·∫†T - Ch√∫c m·ª´ng b·∫°n!
                </div>
                
                <div style="display:flex;gap:15px;justify-content:center;">
                    <button class="btn btn-secondary" id="btn-review">üìã Xem l·∫°i ƒë√°p √°n</button>
                    <button class="btn btn-success" id="btn-retry">üîÑ Thi l·∫°i</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ============ TEST DATA ============
        const HSK_TESTS = {
            1: {
                time: 35, // minutes
                listening: [
                    { type: 'listen-match', audio: '‰Ω†Â•Ω', options: ['üëã Ch√†o h·ªèi', 'üçé Tr√°i c√¢y', 'üìö S√°ch', 'üè† Nh√†'], answer: 0 },
                    { type: 'listen-match', audio: 'Ë∞¢Ë∞¢', options: ['‚ùì H·ªèi', 'üôè C·∫£m ∆°n', 'üëã T·∫°m bi·ªát', 'üòä Vui'], answer: 1 },
                    { type: 'listen-match', audio: 'ÂÜçËßÅ', options: ['üôè C·∫£m ∆°n', 'üëã T·∫°m bi·ªát', '‚ùì Xin l·ªói', 'üëç T·ªët'], answer: 1 },
                    { type: 'listen-match', audio: 'ËãπÊûú', options: ['üçé T√°o', 'üçå Chu·ªëi', 'üçä Cam', 'üçá Nho'], answer: 0 },
                    { type: 'listen-match', audio: 'Â≠¶Áîü', options: ['üë®‚Äçüè´ Gi√°o vi√™n', 'üë®‚Äçüéì H·ªçc sinh', 'üë®‚Äç‚öïÔ∏è B√°c sƒ©', 'üë®‚Äçüíº Nh√¢n vi√™n'], answer: 1 },
                    { type: 'listen-true-false', audio: 'ÊàëÊòØ‰∏≠ÂõΩ‰∫∫', question: 'Ng∆∞·ªùi n√≥i l√† ng∆∞·ªùi Trung Qu·ªëc?', answer: true },
                    { type: 'listen-true-false', audio: '‰ªäÂ§©ÂæàÂÜ∑', question: 'H√¥m nay tr·ªùi n√≥ng?', answer: false },
                    { type: 'listen-true-false', audio: '‰ªñÊòØËÄÅÂ∏à', question: 'Anh ·∫•y l√† gi√°o vi√™n?', answer: true },
                    { type: 'listen-choose', audio: '‰Ω†Âè´‰ªÄ‰πàÂêçÂ≠óÔºü', question: 'C√¢u h·ªèi n√†y h·ªèi v·ªÅ g√¨?', options: ['Tu·ªïi', 'T√™n', 'Ngh·ªÅ nghi·ªáp', 'Qu√™ qu√°n'], answer: 1 },
                    { type: 'listen-choose', audio: '‰Ω†‰ªäÂπ¥Â§öÂ§ßÔºü', question: 'C√¢u h·ªèi n√†y h·ªèi v·ªÅ g√¨?', options: ['T√™n', 'Tu·ªïi', 'ƒê·ªãa ch·ªâ', 'S·ªë ƒëi·ªán tho·∫°i'], answer: 1 },
                ],
                reading: [
                    { type: 'read-match', text: 'Â•Ω', options: ['h«éo', 'h√†o', 'hƒÅo', 'h√°o'], answer: 0 },
                    { type: 'read-match', text: '‰∏≠ÂõΩ', options: ['zh≈çng gu√≥', 'zh√≤ng gu√≥', 'zh«íng gu√≥', 'zh√≥ng gu√≥'], answer: 0 },
                    { type: 'read-match', text: 'Â≠¶‰π†', options: ['xu√© x√≠', 'xuƒõ x√¨', 'xu√© x√¨', 'xuƒõ x√≠'], answer: 0 },
                    { type: 'read-fill', text: 'Êàë___Â≠¶Áîü„ÄÇ', options: ['ÊòØ', 'Êúâ', 'Âú®', 'Âéª'], answer: 0 },
                    { type: 'read-fill', text: '‰ªñ___‰∏≠ÂõΩ‰∫∫„ÄÇ', options: ['ÊòØ', 'Êúâ', 'Âú®', 'Âéª'], answer: 0 },
                    { type: 'read-fill', text: 'ÊàëÂñúÊ¨¢___‰π¶„ÄÇ', options: ['Áúã', 'Âê¨', 'ËØ¥', 'ÂÜô'], answer: 0 },
                    { type: 'read-comprehension', text: 'Â∞èÊòéÊòØÂ≠¶Áîü„ÄÇ‰ªñ‰ªäÂπ¥‰∫åÂçÅÂ≤Å„ÄÇ‰ªñÂ≠¶‰π†‰∏≠Êñá„ÄÇ', question: 'Â∞èÊòéÂ§öÂ§ß‰∫ÜÔºü', options: ['ÂçÅÂ≤Å', '‰∫åÂçÅÂ≤Å', '‰∏âÂçÅÂ≤Å', 'ÂõõÂçÅÂ≤Å'], answer: 1 },
                    { type: 'read-comprehension', text: 'ÊàëÂÆ∂ÊúâÂõõÂè£‰∫∫ÔºöÁà∏Áà∏„ÄÅÂ¶àÂ¶à„ÄÅÂßêÂßêÂíåÊàë„ÄÇ', question: '‰ªñÂÆ∂ÊúâÂá†Âè£‰∫∫Ôºü', options: ['‰∏âÂè£', 'ÂõõÂè£', '‰∫îÂè£', 'ÂÖ≠Âè£'], answer: 1 },
                    { type: 'read-comprehension', text: '‰ªäÂ§©ÊòØÊòüÊúü‰∏Ä„ÄÇÊòéÂ§©ÊòØÊòüÊúü‰∫å„ÄÇ', question: '‰ªäÂ§©ÊòüÊúüÂá†Ôºü', options: ['ÊòüÊúüÊó•', 'ÊòüÊúü‰∏Ä', 'ÊòüÊúü‰∫å', 'ÊòüÊúü‰∏â'], answer: 1 },
                    { type: 'read-comprehension', text: 'ÊàëÂñúÊ¨¢ÂêÉËãπÊûúÔºå‰∏çÂñúÊ¨¢ÂêÉÈ¶ôËïâ„ÄÇ', question: '‰ªñÂñúÊ¨¢ÂêÉ‰ªÄ‰πàÔºü', options: ['È¶ôËïâ', 'ËãπÊûú', 'Ê©ôÂ≠ê', 'Ëë°ËêÑ'], answer: 1 },
                ]
            },
            2: {
                time: 50,
                listening: [
                    { type: 'listen-match', audio: 'È£ûÊú∫', options: ['‚úàÔ∏è M√°y bay', 'üöó √î t√¥', 'üöÇ T√†u h·ªèa', 'üö¢ T√†u th·ªßy'], answer: 0 },
                    { type: 'listen-match', audio: 'ÂåªÈô¢', options: ['üè´ Tr∆∞·ªùng h·ªçc', 'üè• B·ªánh vi·ªán', 'üè™ C·ª≠a h√†ng', 'üè¶ Ng√¢n h√†ng'], answer: 1 },
                    { type: 'listen-match', audio: 'ËøêÂä®', options: ['üéµ √Çm nh·∫°c', 'üé® H·ªôi h·ªça', '‚öΩ Th·ªÉ thao', 'üìö ƒê·ªçc s√°ch'], answer: 2 },
                    { type: 'listen-choose', audio: 'ËØ∑ÈóÆÔºåÁÅ´ËΩ¶Á´ôÊÄé‰πàËµ∞Ôºü', question: 'Ng∆∞·ªùi n√≥i mu·ªën ƒëi ƒë√¢u?', options: ['S√¢n bay', 'Ga t√†u', 'B·∫øn xe', 'B·ªánh vi·ªán'], answer: 1 },
                    { type: 'listen-choose', audio: 'Ëøô‰ª∂Ë°£ÊúçÂ§öÂ∞ëÈí±Ôºü', question: 'Ng∆∞·ªùi n√≥i h·ªèi v·ªÅ g√¨?', options: ['M√†u s·∫Øc', 'K√≠ch c·ª°', 'Gi√° ti·ªÅn', 'Ch·∫•t li·ªáu'], answer: 2 },
                    { type: 'listen-true-false', audio: 'ÊàëÊØèÂ§©Êó©‰∏äÂÖ≠ÁÇπËµ∑Â∫ä', question: 'Ng∆∞·ªùi n√≥i d·∫≠y l√∫c 7 gi·ªù?', answer: false },
                    { type: 'listen-true-false', audio: 'Âåó‰∫¨ÁöÑÂ§©Ê∞îÂæàÂ•Ω', question: 'Th·ªùi ti·∫øt B·∫Øc Kinh t·ªët?', answer: true },
                    { type: 'listen-dialogue', audio: 'A: ‰Ω†ÂéªÂì™ÂÑøÔºüB: ÊàëÂéªË∂ÖÂ∏Ç‰π∞‰∏úË•ø„ÄÇ', question: 'B ƒëi ƒë√¢u?', options: ['Tr∆∞·ªùng h·ªçc', 'Si√™u th·ªã', 'C√¥ng ty', 'Nh√† h√†ng'], answer: 1 },
                    { type: 'listen-dialogue', audio: 'A: ‰ªäÂ§©Âá†Âè∑ÔºüB: ‰ªäÂ§©ÂçÅ‰∫åÊúà‰∫åÂçÅ‰∫îÂè∑„ÄÇ', question: 'H√¥m nay ng√†y bao nhi√™u?', options: ['24', '25', '26', '27'], answer: 1 },
                    { type: 'listen-dialogue', audio: 'A: ‰Ω†ÂñúÊ¨¢‰ªÄ‰πàÈ¢úËâ≤ÔºüB: ÊàëÂñúÊ¨¢ËìùËâ≤„ÄÇ', question: 'B th√≠ch m√†u g√¨?', options: ['ƒê·ªè', 'Xanh l√°', 'Xanh d∆∞∆°ng', 'V√†ng'], answer: 2 },
                ],
                reading: [
                    { type: 'read-match', text: '‰æøÂÆú', options: ['pi√°nyi', 'bi√†nyi', 'pi√°nyi', 'bi√†ny√≠'], answer: 0 },
                    { type: 'read-match', text: 'ÊóÖÊ∏∏', options: ['l«öy√≥u', 'l«îy√≥u', 'l«öy√≤u', 'l«îy√≤u'], answer: 0 },
                    { type: 'read-fill', text: 'Êàë___ÂéªËøá‰∏≠ÂõΩ„ÄÇ', options: ['Ê≤°', '‰∏ç', 'Âà´', 'Êó†'], answer: 0 },
                    { type: 'read-fill', text: 'Ëøô‰∏™ËãπÊûú___ÈÇ£‰∏™Â§ß„ÄÇ', options: ['ÊØî', 'Âíå', 'Ë∑ü', '‰∏é'], answer: 0 },
                    { type: 'read-fill', text: '‰ªñ___Âú®ÁúãÁîµËßÜ„ÄÇ', options: ['Ê≠£', 'Êâç', 'Â∞±', 'Âèà'], answer: 0 },
                    { type: 'read-order', text: 'ÊéíÂàóÈ°∫Â∫èÔºöÊàë/Âéª/ÊÉ≥/‰∏≠ÂõΩ', options: ['ÊàëÊÉ≥Âéª‰∏≠ÂõΩ', 'ÂéªÊàëÊÉ≥‰∏≠ÂõΩ', 'ÊÉ≥ÊàëÂéª‰∏≠ÂõΩ', '‰∏≠ÂõΩÊàëÊÉ≥Âéª'], answer: 0 },
                    { type: 'read-comprehension', text: 'Êò®Â§©ÊàëÂíåÊúãÂèãÂéªÁúãÁîµÂΩ±‰∫Ü„ÄÇÁîµÂΩ±ÂæàÂ•ΩÁúãÔºåÊàë‰ª¨ÈÉΩÂæàÈ´òÂÖ¥„ÄÇ', question: '‰ªñ‰ª¨Êò®Â§©ÂÅö‰ªÄ‰πà‰∫ÜÔºü', options: ['Áúã‰π¶', 'ÁúãÁîµÂΩ±', 'ËøêÂä®', 'ÊóÖÊ∏∏'], answer: 1 },
                    { type: 'read-comprehension', text: 'ÊàëÁöÑÁà±Â•ΩÊòØÊ∏∏Ê≥≥„ÄÇÊØè‰∏™ÊòüÊúüÂÖ≠ÊàëÈÉΩÂéªÊ∏∏Ê≥≥„ÄÇ', question: '‰ªñ‰ªÄ‰πàÊó∂ÂÄôÊ∏∏Ê≥≥Ôºü', options: ['ÊØèÂ§©', 'ÊòüÊúüÂÖ≠', 'ÊòüÊúüÊó•', 'Âë®Êú´'], answer: 1 },
                    { type: 'read-comprehension', text: 'ËøôÂÆ∂È•≠Â∫óÁöÑËèúÂæàÂ•ΩÂêÉÔºå‰ΩÜÊòØÊúâÁÇπÂÑøË¥µ„ÄÇ', question: 'ËøôÂÆ∂È•≠Â∫óÊÄé‰πàÊ†∑Ôºü', options: ['‰æøÂÆúÂ•ΩÂêÉ', 'Ë¥µ‰ΩÜÂ•ΩÂêÉ', '‰æøÂÆúÈöæÂêÉ', 'Ë¥µÂèàÈöæÂêÉ'], answer: 1 },
                    { type: 'read-comprehension', text: 'ÊàëÂºüÂºü‰ªäÂπ¥ÂçÅÂÖ´Â≤ÅÔºåÊØîÊàëÂ∞è‰∏âÂ≤Å„ÄÇ', question: '"Êàë"‰ªäÂπ¥Â§öÂ§ßÔºü', options: ['15Â≤Å', '18Â≤Å', '21Â≤Å', '24Â≤Å'], answer: 2 },
                ]
            },
            3: {
                time: 85,
                listening: [
                    { type: 'listen-choose', audio: 'ËøôÊ¨°ËÄÉËØïÊàëËÄÉÂæó‰∏çÂ§™Â•ΩÔºåÂè™Âæó‰∫Ü‰∏ÉÂçÅÂàÜ„ÄÇ', question: '‰ªñËÄÉ‰∫ÜÂ§öÂ∞ëÂàÜÔºü', options: ['60ÂàÜ', '70ÂàÜ', '80ÂàÜ', '90ÂàÜ'], answer: 1 },
                    { type: 'listen-choose', audio: 'ËôΩÁÑ∂‰ªäÂ§©ÂæàÁ¥ØÔºå‰ΩÜÊòØÊàëËøòÊòØË¶ÅÂéªÂÅ•Ë∫´ÊàøÈîªÁÇº„ÄÇ', question: '‰ªñ‰ªäÂ§©Ë¶ÅÂÅö‰ªÄ‰πàÔºü', options: ['‰ºëÊÅØ', 'Â∑•‰Ωú', 'ÈîªÁÇº', 'Â≠¶‰π†'], answer: 2 },
                    { type: 'listen-dialogue', audio: 'A: ‰Ω†ËßâÂæóËøô‰∏™Â∑•‰ΩúÊÄé‰πàÊ†∑ÔºüB: Â∑•ËµÑ‰∏çÈîôÔºå‰ΩÜÊòØÂ§™Âøô‰∫Ü„ÄÇ', question: 'BËßâÂæóÂ∑•‰ΩúÊÄé‰πàÊ†∑Ôºü', options: ['ÂæàËΩªÊùæ', 'Â∑•ËµÑ‰Ωé', 'Â§™Âøô', 'ÂæàÊó†ËÅä'], answer: 2 },
                    { type: 'listen-dialogue', audio: 'A: Âë®Êú´‰Ω†Êúâ‰ªÄ‰πàÊâìÁÆóÔºüB: ÊàëÊâìÁÆóÂéªÁà¨Â±±„ÄÇ', question: 'BÂë®Êú´Ë¶ÅÂÅö‰ªÄ‰πàÔºü', options: ['Ê∏∏Ê≥≥', 'Áà¨Â±±', 'ÁúãÁîµÂΩ±', 'Ë¥≠Áâ©'], answer: 1 },
                    { type: 'listen-true-false', audio: 'Â≠¶‰π†ËØ≠Ë®ÄÊúÄÈáçË¶ÅÁöÑÊòØÂ§öÁªÉ‰π†', question: 'Â≠¶ËØ≠Ë®ÄË¶ÅÂ§öÁªÉ‰π†?', answer: true },
                ],
                reading: [
                    { type: 'read-fill', text: '___‰ªñÂæàÂøôÔºå___ËøòÊòØÊù•Â∏ÆÂä©Êàë‰∫Ü„ÄÇ', options: ['ËôΩÁÑ∂...‰ΩÜÊòØ', 'Âõ†‰∏∫...ÊâÄ‰ª•', 'Â¶ÇÊûú...Â∞±', '‰∏ç‰ΩÜ...ËÄå‰∏î'], answer: 0 },
                    { type: 'read-fill', text: 'Ëøô‰∏™ÈóÆÈ¢ò___ÁÆÄÂçï___Èöæ„ÄÇ', options: ['‰∏çÊòØ...ËÄåÊòØ', 'Âèà...Âèà', 'Êó¢...‰πü', 'ÊàñËÄÖ...ÊàñËÄÖ'], answer: 0 },
                    { type: 'read-comprehension', text: 'ÈöèÁùÄÁßëÊäÄÁöÑÂèëÂ±ïÔºå‰∫∫‰ª¨ÁöÑÁîüÊ¥ªË∂äÊù•Ë∂äÊñπ‰æø‰∫Ü„ÄÇÁé∞Âú®ÔºåÊàë‰ª¨ÂèØ‰ª•Áî®ÊâãÊú∫ÂÅöÂæàÂ§ö‰∫ãÊÉÖÔºåÊØîÂ¶ÇË¥≠Áâ©„ÄÅËÆ¢È§ê„ÄÅÊâìËΩ¶Á≠âÁ≠â„ÄÇ', question: 'ÊñáÁ´†‰∏ªË¶ÅËØ¥‰ªÄ‰πàÔºü', options: ['ÊâãÊú∫ÁöÑÂéÜÂè≤', 'ÁßëÊäÄËÆ©ÁîüÊ¥ªÊõ¥Êñπ‰æø', 'Â¶Ç‰Ωï‰ΩøÁî®ÊâãÊú∫', 'ÊâãÊú∫ÁöÑÈóÆÈ¢ò'], answer: 1 },
                    { type: 'read-comprehension', text: '‰∏≠ÂõΩÊúâÂè•ËØùÂè´"Ê¥ªÂà∞ËÄÅÔºåÂ≠¶Âà∞ËÄÅ"ÔºåÊÑèÊÄùÊòØ‰∫∫Â∫îËØ•‰∏ÄËæàÂ≠êÈÉΩÂú®Â≠¶‰π†„ÄÇÂ≠¶‰π†‰∏ç‰ªÖÊòØÂπ¥ËΩª‰∫∫ÁöÑ‰∫ãÔºåËÄÅÂπ¥‰∫∫‰πüÂ∫îËØ•ÁªßÁª≠Â≠¶‰π†Êñ∞Áü•ËØÜ„ÄÇ', question: '"Ê¥ªÂà∞ËÄÅÔºåÂ≠¶Âà∞ËÄÅ"ÊòØ‰ªÄ‰πàÊÑèÊÄùÔºü', options: ['ËÄÅ‰∫∫‰∏çÁî®Â≠¶‰π†', 'Â≠¶‰π†ÂæàËæõËã¶', 'Â∫îËØ•ÁªàË∫´Â≠¶‰π†', 'Âπ¥ËΩª‰∫∫Ë¶ÅÂ≠¶‰π†'], answer: 2 },
                    { type: 'read-comprehension', text: '‰øùÊä§ÁéØÂ¢ÉÊòØÊØè‰∏™‰∫∫ÁöÑË¥£‰ªª„ÄÇÊàë‰ª¨Â∫îËØ•Â∞ëÁî®Â°ëÊñôË¢ãÔºåÂ§öÂùêÂÖ¨ÂÖ±‰∫§ÈÄöÔºåËäÇÁ∫¶Áî®Ê∞¥Áî®Áîµ„ÄÇ', question: 'ÊñáÁ´†Âª∫ËÆÆÊàë‰ª¨ÊÄé‰πàÂÅöÔºü', options: ['Â§öÂºÄËΩ¶', 'Â§öÁî®Â°ëÊñôË¢ã', '‰øùÊä§ÁéØÂ¢É', 'Êµ™Ë¥πËµÑÊ∫ê'], answer: 2 },
                ]
            }
        };
        
        // ============ STATE ============
        const state = {
            level: 1,
            section: 'listening',
            currentQuestion: 0,
            answers: {},
            flagged: new Set(),
            timeLeft: 0,
            timer: null,
            testStarted: false,
            testEnded: false,
            playsLeft: {}
        };
        
        // ============ TTS ============
        function speak(text) {
            return new Promise(resolve => {
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'zh-CN';
                utterance.rate = 0.8;
                utterance.onend = resolve;
                speechSynthesis.speak(utterance);
            });
        }
        
        // ============ UI ============
        function selectLevel(level) {
            state.level = level;
            document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
            document.querySelector(`.level-card[data-level="${level}"]`).classList.add('selected');
            
            document.getElementById('selected-level').textContent = level;
            document.getElementById('start-screen').style.display = 'block';
        }
        
        function startTest() {
            state.testStarted = true;
            state.testEnded = false;
            state.section = 'listening';
            state.currentQuestion = 0;
            state.answers = {};
            state.flagged = new Set();
            state.timeLeft = HSK_TESTS[state.level].time * 60;
            state.playsLeft = {};
            
            document.getElementById('level-screen').style.display = 'none';
            document.getElementById('test-screen').style.display = 'block';
            document.getElementById('results-screen').style.display = 'none';
            
            renderQuestion();
            renderQuestionNav();
            startTimer();
        }
        
        function getQuestions() {
            return HSK_TESTS[state.level][state.section];
        }
        
        function renderQuestion() {
            const questions = getQuestions();
            const q = questions[state.currentQuestion];
            const qKey = `${state.section}-${state.currentQuestion}`;
            
            document.getElementById('question-progress').textContent = 
                `${state.currentQuestion + 1}/${questions.length}`;
            document.getElementById('progress-fill').style.width = 
                `${(state.currentQuestion + 1) / questions.length * 100}%`;
            document.getElementById('current-section').textContent = 
                state.section === 'listening' ? 'Nghe hi·ªÉu' : 'ƒê·ªçc hi·ªÉu';
            
            let html = `<div class="question-number">C√¢u ${state.currentQuestion + 1}</div>`;
            
            // Audio for listening
            if (state.section === 'listening') {
                const plays = state.playsLeft[qKey] ?? 2;
                html += `
                    <div class="question-audio">
                        <button class="audio-btn" onclick="playAudio()" ${plays <= 0 ? 'disabled' : ''}>
                            üîä Nghe (${plays} l·∫ßn)
                        </button>
                    </div>
                `;
            }
            
            // Question text
            if (q.text) {
                html += `<div class="question-text">${q.text}</div>`;
            }
            if (q.question) {
                html += `<div class="question-text" style="color:#fbbf24;">${q.question}</div>`;
            }
            
            // Options
            const letters = ['A', 'B', 'C', 'D'];
            html += '<div class="options">';
            q.options.forEach((opt, i) => {
                const selected = state.answers[qKey] === i;
                html += `
                    <div class="option ${selected ? 'selected' : ''}" onclick="selectAnswer(${i})">
                        <div class="option-letter">${letters[i]}</div>
                        <div class="option-text">${opt}</div>
                    </div>
                `;
            });
            html += '</div>';
            
            document.getElementById('question-card').innerHTML = html;
            
            // Update nav buttons
            document.getElementById('btn-prev').disabled = state.currentQuestion === 0;
            document.getElementById('btn-flag').textContent = 
                state.flagged.has(qKey) ? 'üö© B·ªè ƒë√°nh d·∫•u' : 'üö© ƒê√°nh d·∫•u';
        }
        
        function renderQuestionNav() {
            const questions = getQuestions();
            const html = questions.map((_, i) => {
                const qKey = `${state.section}-${i}`;
                let cls = 'q-dot';
                if (i === state.currentQuestion) cls += ' current';
                if (state.answers[qKey] !== undefined) cls += ' answered';
                if (state.flagged.has(qKey)) cls += ' flagged';
                return `<div class="${cls}" onclick="goToQuestion(${i})">${i + 1}</div>`;
            }).join('');
            document.getElementById('question-nav').innerHTML = html;
        }
        
        async function playAudio() {
            const q = getQuestions()[state.currentQuestion];
            const qKey = `${state.section}-${state.currentQuestion}`;
            
            if ((state.playsLeft[qKey] ?? 2) <= 0) return;
            state.playsLeft[qKey] = (state.playsLeft[qKey] ?? 2) - 1;
            
            await speak(q.audio);
            renderQuestion();
        }
        
        function selectAnswer(index) {
            const qKey = `${state.section}-${state.currentQuestion}`;
            state.answers[qKey] = index;
            renderQuestion();
            renderQuestionNav();
        }
        
        function goToQuestion(index) {
            state.currentQuestion = index;
            renderQuestion();
            renderQuestionNav();
        }
        
        function prevQuestion() {
            if (state.currentQuestion > 0) {
                state.currentQuestion--;
                renderQuestion();
                renderQuestionNav();
            }
        }
        
        function nextQuestion() {
            const questions = getQuestions();
            if (state.currentQuestion < questions.length - 1) {
                state.currentQuestion++;
                renderQuestion();
                renderQuestionNav();
            } else if (state.section === 'listening') {
                // Move to reading section
                if (confirm('Chuy·ªÉn sang ph·∫ßn ƒê·ªçc hi·ªÉu? B·∫°n kh√¥ng th·ªÉ quay l·∫°i ph·∫ßn Nghe.')) {
                    state.section = 'reading';
                    state.currentQuestion = 0;
                    document.querySelector('[data-section="listening"]').classList.remove('active');
                    document.querySelector('[data-section="listening"]').classList.add('completed');
                    document.querySelector('[data-section="reading"]').classList.add('active');
                    document.querySelector('[data-section="reading"]').disabled = false;
                    renderQuestion();
                    renderQuestionNav();
                }
            } else {
                // End test
                if (confirm('N·ªôp b√†i thi?')) {
                    endTest();
                }
            }
        }
        
        function toggleFlag() {
            const qKey = `${state.section}-${state.currentQuestion}`;
            if (state.flagged.has(qKey)) {
                state.flagged.delete(qKey);
            } else {
                state.flagged.add(qKey);
            }
            renderQuestion();
            renderQuestionNav();
        }
        
        function startTimer() {
            state.timer = setInterval(() => {
                state.timeLeft--;
                const mins = Math.floor(state.timeLeft / 60);
                const secs = state.timeLeft % 60;
                const timerEl = document.getElementById('test-timer');
                timerEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;
                
                if (state.timeLeft <= 60) {
                    timerEl.classList.add('warning');
                }
                
                if (state.timeLeft <= 0) {
                    endTest();
                }
            }, 1000);
        }
        
        function endTest() {
            clearInterval(state.timer);
            state.testEnded = true;
            
            // Calculate scores
            const test = HSK_TESTS[state.level];
            let listeningCorrect = 0, readingCorrect = 0;
            
            test.listening.forEach((q, i) => {
                if (state.answers[`listening-${i}`] === q.answer) listeningCorrect++;
            });
            test.reading.forEach((q, i) => {
                if (state.answers[`reading-${i}`] === q.answer) readingCorrect++;
            });
            
            const listeningScore = Math.round(listeningCorrect / test.listening.length * 100);
            const readingScore = Math.round(readingCorrect / test.reading.length * 100);
            const totalScore = listeningScore + readingScore;
            const passed = totalScore >= 120;
            
            // Show results
            document.getElementById('test-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
            
            document.getElementById('results-icon').textContent = passed ? 'üéâ' : 'üò¢';
            document.getElementById('results-score').textContent = `${totalScore}/200`;
            document.getElementById('listening-score').textContent = `${listeningScore}/100`;
            document.getElementById('reading-score').textContent = `${readingScore}/100`;
            document.getElementById('pass-status').className = passed ? 'pass' : 'fail';
            document.getElementById('pass-status').textContent = passed 
                ? '‚úÖ ƒê·∫†T - Ch√∫c m·ª´ng b·∫°n!' 
                : '‚ùå CH∆ØA ƒê·∫†T - C·ªë g·∫Øng l·∫ßn sau!';
        }
        
        function retry() {
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('level-screen').style.display = 'block';
            document.getElementById('start-screen').style.display = 'none';
            document.querySelectorAll('.level-card').forEach(c => c.classList.remove('selected'));
            document.querySelectorAll('.section-tab').forEach(t => {
                t.classList.remove('active', 'completed');
                t.disabled = t.dataset.section === 'reading';
            });
            document.querySelector('[data-section="listening"]').classList.add('active');
        }
        
        // ============ INIT ============
        document.querySelectorAll('.level-card').forEach(card => {
            card.addEventListener('click', () => selectLevel(parseInt(card.dataset.level)));
        });
        
        document.getElementById('btn-start-test').addEventListener('click', startTest);
        document.getElementById('btn-prev').addEventListener('click', prevQuestion);
        document.getElementById('btn-next').addEventListener('click', nextQuestion);
        document.getElementById('btn-flag').addEventListener('click', toggleFlag);
        document.getElementById('btn-retry').addEventListener('click', retry);
        document.getElementById('btn-review').addEventListener('click', () => alert('T√≠nh nƒÉng xem l·∫°i ƒë√°p √°n s·∫Ω ƒë∆∞·ª£c c·∫≠p nh·∫≠t!'));
    </script>
</body>
</html>
