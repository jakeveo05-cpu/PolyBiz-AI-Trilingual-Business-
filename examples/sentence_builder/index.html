<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PolyBiz AI - Sentence Builder ÈÄ†Âè•ÁªÉ‰π†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh; color: #fff; padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; font-size: 1.8em; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; }
        
        .card {
            background: rgba(255,255,255,0.05); border-radius: 15px;
            padding: 20px; backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1); margin-bottom: 20px;
        }
        .card-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; font-weight: bold; font-size: 1.1em;
        }
        
        .btn {
            padding: 10px 20px; border: none; border-radius: 8px;
            cursor: pointer; font-size: 14px; transition: all 0.2s;
        }
        .btn-primary { background: #3b82f6; color: #fff; }
        .btn-success { background: #22c55e; color: #fff; }
        .btn-secondary { background: #6b7280; color: #fff; }
        .btn-warning { background: #f59e0b; color: #000; }
        .btn:hover { transform: scale(1.05); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-group { display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß© Sentence Builder ÈÄ†Âè•ÁªÉ‰π†</h1>
        <p class="subtitle">K√©o th·∫£ t·ª´ ƒë·ªÉ x√¢y d·ª±ng c√¢u ƒë√∫ng ng·ªØ ph√°p</p>

        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-item">
                <div class="stat-value" id="stat-score">0</div>
                <div class="stat-label">ƒêi·ªÉm</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-level">1</div>
                <div class="stat-label">Level</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-combo">0</div>
                <div class="stat-label">Combo</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-time">60</div>
                <div class="stat-label">Gi√¢y ‚è±Ô∏è</div>
            </div>
        </div>
        
        <!-- Main Game -->
        <div class="card">
            <div class="card-header">
                <span>üìù X√¢y d·ª±ng c√¢u</span>
                <span id="question-num">C√¢u 1/10</span>
            </div>
            
            <!-- Translation Target -->
            <div class="translation-box">
                <div class="translation-label">D·ªãch c√¢u n√†y sang ti·∫øng Trung:</div>
                <div class="translation-text" id="translation-text">T√¥i l√† h·ªçc sinh.</div>
            </div>
            
            <!-- Answer Zone -->
            <div class="answer-zone" id="answer-zone">
                <div class="answer-placeholder">K√©o t·ª´ v√†o ƒë√¢y...</div>
            </div>
            
            <!-- Word Bank -->
            <div class="word-bank" id="word-bank">
                <!-- Words will be rendered here -->
            </div>
            
            <!-- Hint -->
            <div class="hint-box" id="hint-box" style="display:none;">
                <span class="hint-label">üí° G·ª£i √Ω:</span>
                <span class="hint-text" id="hint-text"></span>
            </div>
            
            <!-- Feedback -->
            <div class="feedback" id="feedback">
                <div class="feedback-icon" id="feedback-icon">‚úì</div>
                <div class="feedback-text" id="feedback-text">Ch√≠nh x√°c!</div>
                <div class="feedback-correct" id="feedback-correct"></div>
            </div>
            
            <!-- Controls -->
            <div class="btn-group" style="margin-top:20px;">
                <button class="btn btn-warning" id="btn-hint">üí° G·ª£i √Ω (-10ƒë)</button>
                <button class="btn btn-secondary" id="btn-clear">üóëÔ∏è X√≥a</button>
                <button class="btn btn-success" id="btn-check">‚úì Ki·ªÉm tra</button>
                <button class="btn btn-primary" id="btn-next" style="display:none;">Ti·∫øp theo ‚û°Ô∏è</button>
            </div>
        </div>
        
        <!-- Grammar Tips -->
        <div class="card">
            <div class="card-header">
                <span>üìö Ng·ªØ ph√°p c∆° b·∫£n</span>
                <button class="btn btn-secondary btn-sm" id="btn-toggle-grammar">Thu g·ªçn</button>
            </div>
            <div class="grammar-tips" id="grammar-tips">
                <div class="grammar-item">
                    <div class="grammar-title">üîπ C·∫•u tr√∫c SVO</div>
                    <div class="grammar-desc">Ch·ªß ng·ªØ + ƒê·ªông t·ª´ + T√¢n ng·ªØ: ÊàëÂêÉÈ•≠ (T√¥i ƒÉn c∆°m)</div>
                </div>
                <div class="grammar-item">
                    <div class="grammar-title">üîπ ÊòØ (sh√¨) - L√†</div>
                    <div class="grammar-desc">A ÊòØ B: ÊàëÊòØÂ≠¶Áîü (T√¥i l√† h·ªçc sinh)</div>
                </div>
                <div class="grammar-item">
                    <div class="grammar-title">üîπ ÁöÑ (de) - C·ªßa</div>
                    <div class="grammar-desc">S·ªü h·ªØu: ÊàëÁöÑ‰π¶ (S√°ch c·ªßa t√¥i)</div>
                </div>
                <div class="grammar-item">
                    <div class="grammar-title">üîπ Ph·ªß ƒë·ªãnh v·ªõi ‰∏ç/Ê≤°</div>
                    <div class="grammar-desc">‰∏ç + ƒë·ªông t·ª´/t√≠nh t·ª´, Ê≤° + c√≥/ƒë√£ l√†m</div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .stats-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;
            margin-bottom: 20px;
        }
        .stat-item {
            text-align: center; padding: 15px;
            background: rgba(0,0,0,0.2); border-radius: 10px;
        }
        .stat-value { font-size: 2em; font-weight: bold; color: #60a5fa; }
        .stat-label { font-size: 0.85em; color: #888; }
        
        .translation-box {
            text-align: center; padding: 20px;
            background: rgba(0,0,0,0.3); border-radius: 10px; margin-bottom: 20px;
        }
        .translation-label { color: #888; font-size: 0.9em; margin-bottom: 10px; }
        .translation-text { font-size: 1.5em; color: #fbbf24; }
        
        .answer-zone {
            min-height: 80px; padding: 15px;
            background: rgba(255,255,255,0.05); border: 2px dashed #444;
            border-radius: 10px; margin-bottom: 20px;
            display: flex; flex-wrap: wrap; gap: 10px;
            align-items: center; justify-content: center;
        }
        .answer-zone.dragover { border-color: #3b82f6; background: rgba(59,130,246,0.1); }
        .answer-zone.correct { border-color: #22c55e; background: rgba(34,197,94,0.1); }
        .answer-zone.wrong { border-color: #ef4444; background: rgba(239,68,68,0.1); }
        .answer-placeholder { color: #666; font-style: italic; }
        
        .word-bank {
            display: flex; flex-wrap: wrap; gap: 10px;
            justify-content: center; padding: 15px;
            background: rgba(0,0,0,0.2); border-radius: 10px;
        }
        
        .word-chip {
            padding: 12px 20px; background: rgba(59,130,246,0.3);
            border: 2px solid #3b82f6; border-radius: 10px;
            cursor: grab; font-size: 1.3em; transition: all 0.2s;
            user-select: none;
        }
        .word-chip:hover { transform: scale(1.05); background: rgba(59,130,246,0.5); }
        .word-chip.dragging { opacity: 0.5; cursor: grabbing; }
        .word-chip.in-answer { background: rgba(34,197,94,0.3); border-color: #22c55e; }
        .word-chip .pinyin { font-size: 0.7em; color: #aaa; display: block; }
        
        .hint-box {
            padding: 15px; background: rgba(245,158,11,0.1);
            border: 1px solid #f59e0b; border-radius: 10px; margin: 15px 0;
        }
        .hint-label { color: #f59e0b; font-weight: bold; }
        .hint-text { color: #fbbf24; }
        
        .feedback {
            text-align: center; padding: 20px; border-radius: 10px;
            margin: 15px 0; display: none;
        }
        .feedback.show { display: block; }
        .feedback.correct { background: rgba(34,197,94,0.2); border: 1px solid #22c55e; }
        .feedback.wrong { background: rgba(239,68,68,0.2); border: 1px solid #ef4444; }
        .feedback-icon { font-size: 2.5em; margin-bottom: 10px; }
        .feedback-text { font-size: 1.2em; margin-bottom: 10px; }
        .feedback-correct { color: #22c55e; font-size: 1.3em; }
        
        .grammar-tips { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .grammar-item {
            padding: 12px; background: rgba(0,0,0,0.2); border-radius: 8px;
        }
        .grammar-title { color: #60a5fa; font-weight: bold; margin-bottom: 5px; }
        .grammar-desc { color: #aaa; font-size: 0.9em; }
        
        .btn-sm { padding: 5px 10px; font-size: 12px; }
        
        @media (max-width: 600px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .grammar-tips { grid-template-columns: 1fr; }
        }
    </style>

    <script>
        // ============ DATA ============
        const SENTENCES = [
            // Level 1 - Basic SVO
            { vi: 'T√¥i l√† h·ªçc sinh.', zh: 'ÊàëÊòØÂ≠¶Áîü„ÄÇ', words: ['Êàë', 'ÊòØ', 'Â≠¶Áîü'], pinyin: ['w«í', 'sh√¨', 'xu√©shƒìng'], hint: 'Ch·ªß ng·ªØ + ÊòØ + danh t·ª´', level: 1 },
            { vi: 'Anh ·∫•y l√† gi√°o vi√™n.', zh: '‰ªñÊòØËÄÅÂ∏à„ÄÇ', words: ['‰ªñ', 'ÊòØ', 'ËÄÅÂ∏à'], pinyin: ['tƒÅ', 'sh√¨', 'l«éoshƒ´'], hint: 'Ch·ªß ng·ªØ + ÊòØ + ngh·ªÅ nghi·ªáp', level: 1 },
            { vi: 'T√¥i ƒÉn c∆°m.', zh: 'ÊàëÂêÉÈ•≠„ÄÇ', words: ['Êàë', 'ÂêÉ', 'È•≠'], pinyin: ['w«í', 'chƒ´', 'f√†n'], hint: 'Ch·ªß ng·ªØ + ƒë·ªông t·ª´ + t√¢n ng·ªØ', level: 1 },
            { vi: 'C√¥ ·∫•y u·ªëng n∆∞·ªõc.', zh: 'Â•πÂñùÊ∞¥„ÄÇ', words: ['Â•π', 'Âñù', 'Ê∞¥'], pinyin: ['tƒÅ', 'hƒì', 'shu«ê'], hint: 'Ch·ªß ng·ªØ + ƒë·ªông t·ª´ + t√¢n ng·ªØ', level: 1 },
            
            // Level 2 - With adjectives
            { vi: 'Ti·∫øng Trung r·∫•t kh√≥.', zh: '‰∏≠ÊñáÂæàÈöæ„ÄÇ', words: ['‰∏≠Êñá', 'Âæà', 'Èöæ'], pinyin: ['zh≈çngw√©n', 'hƒõn', 'n√°n'], hint: 'Danh t·ª´ + Âæà + t√≠nh t·ª´', level: 2 },
            { vi: 'C√¥ ·∫•y r·∫•t ƒë·∫πp.', zh: 'Â•πÂæàÊºÇ‰∫Æ„ÄÇ', words: ['Â•π', 'Âæà', 'ÊºÇ‰∫Æ'], pinyin: ['tƒÅ', 'hƒõn', 'pi√†oliang'], hint: 'Ch·ªß ng·ªØ + Âæà + t√≠nh t·ª´', level: 2 },
            { vi: 'H√¥m nay tr·ªùi r·∫•t n√≥ng.', zh: '‰ªäÂ§©ÂæàÁÉ≠„ÄÇ', words: ['‰ªäÂ§©', 'Âæà', 'ÁÉ≠'], pinyin: ['jƒ´ntiƒÅn', 'hƒõn', 'r√®'], hint: 'Th·ªùi gian + Âæà + t√≠nh t·ª´', level: 2 },
            
            // Level 3 - With ÁöÑ
            { vi: 'S√°ch c·ªßa t√¥i.', zh: 'ÊàëÁöÑ‰π¶„ÄÇ', words: ['Êàë', 'ÁöÑ', '‰π¶'], pinyin: ['w«í', 'de', 'sh≈´'], hint: 'ƒê·∫°i t·ª´ + ÁöÑ + danh t·ª´', level: 3 },
            { vi: 'ƒê√¢y l√† b·∫°n c·ªßa t√¥i.', zh: 'ËøôÊòØÊàëÁöÑÊúãÂèã„ÄÇ', words: ['Ëøô', 'ÊòØ', 'Êàë', 'ÁöÑ', 'ÊúãÂèã'], pinyin: ['zh√®', 'sh√¨', 'w«í', 'de', 'p√©ngyou'], hint: 'ËøôÊòØ + s·ªü h·ªØu + danh t·ª´', level: 3 },
            { vi: 'M·∫π c·ªßa anh ·∫•y l√† b√°c sƒ©.', zh: '‰ªñÁöÑÂ¶àÂ¶àÊòØÂåªÁîü„ÄÇ', words: ['‰ªñ', 'ÁöÑ', 'Â¶àÂ¶à', 'ÊòØ', 'ÂåªÁîü'], pinyin: ['tƒÅ', 'de', 'mƒÅma', 'sh√¨', 'yƒ´shƒìng'], hint: 'S·ªü h·ªØu + ÊòØ + ngh·ªÅ', level: 3 },
            
            // Level 4 - Negation
            { vi: 'T√¥i kh√¥ng ph·∫£i l√† ng∆∞·ªùi Trung Qu·ªëc.', zh: 'Êàë‰∏çÊòØ‰∏≠ÂõΩ‰∫∫„ÄÇ', words: ['Êàë', '‰∏ç', 'ÊòØ', '‰∏≠ÂõΩ‰∫∫'], pinyin: ['w«í', 'b√π', 'sh√¨', 'zh≈çnggu√≥r√©n'], hint: '‰∏çÊòØ ƒë·ªÉ ph·ªß ƒë·ªãnh', level: 4 },
            { vi: 'Anh ·∫•y kh√¥ng u·ªëng c√† ph√™.', zh: '‰ªñ‰∏çÂñùÂíñÂï°„ÄÇ', words: ['‰ªñ', '‰∏ç', 'Âñù', 'ÂíñÂï°'], pinyin: ['tƒÅ', 'b√π', 'hƒì', 'kƒÅfƒìi'], hint: '‰∏ç + ƒë·ªông t·ª´', level: 4 },
            { vi: 'T√¥i ch∆∞a ƒÉn.', zh: 'ÊàëÊ≤°ÂêÉ„ÄÇ', words: ['Êàë', 'Ê≤°', 'ÂêÉ'], pinyin: ['w«í', 'm√©i', 'chƒ´'], hint: 'Ê≤° cho h√†nh ƒë·ªông ch∆∞a x·∫£y ra', level: 4 },
            
            // Level 5 - Questions
            { vi: 'B·∫°n kh·ªèe kh√¥ng?', zh: '‰Ω†Â•ΩÂêóÔºü', words: ['‰Ω†', 'Â•Ω', 'Âêó'], pinyin: ['n«ê', 'h«éo', 'ma'], hint: 'C√¢u + Âêó = c√¢u h·ªèi', level: 5 },
            { vi: 'B·∫°n l√† ai?', zh: '‰Ω†ÊòØË∞ÅÔºü', words: ['‰Ω†', 'ÊòØ', 'Ë∞Å'], pinyin: ['n«ê', 'sh√¨', 'sh√©i'], hint: 'Ë∞Å = ai', level: 5 },
            { vi: 'ƒê√¢y l√† c√°i g√¨?', zh: 'ËøôÊòØ‰ªÄ‰πàÔºü', words: ['Ëøô', 'ÊòØ', '‰ªÄ‰πà'], pinyin: ['zh√®', 'sh√¨', 'sh√©nme'], hint: '‰ªÄ‰πà = c√°i g√¨', level: 5 },
            
            // Level 6 - Time expressions
            { vi: 'T√¥i h·ªçc ti·∫øng Trung m·ªói ng√†y.', zh: 'ÊàëÊØèÂ§©Â≠¶‰∏≠Êñá„ÄÇ', words: ['Êàë', 'ÊØèÂ§©', 'Â≠¶', '‰∏≠Êñá'], pinyin: ['w«í', 'mƒõitiƒÅn', 'xu√©', 'zh≈çngw√©n'], hint: 'Th·ªùi gian ƒë·ª©ng tr∆∞·ªõc ƒë·ªông t·ª´', level: 6 },
            { vi: 'Anh ·∫•y ng√†y mai ƒëi Trung Qu·ªëc.', zh: '‰ªñÊòéÂ§©Âéª‰∏≠ÂõΩ„ÄÇ', words: ['‰ªñ', 'ÊòéÂ§©', 'Âéª', '‰∏≠ÂõΩ'], pinyin: ['tƒÅ', 'm√≠ngtiƒÅn', 'q√π', 'zh≈çnggu√≥'], hint: 'Ch·ªß ng·ªØ + th·ªùi gian + ƒë·ªông t·ª´', level: 6 },
            
            // Level 7 - Location
            { vi: 'T√¥i ·ªü Vi·ªát Nam.', zh: 'ÊàëÂú®Ë∂äÂçó„ÄÇ', words: ['Êàë', 'Âú®', 'Ë∂äÂçó'], pinyin: ['w«í', 'z√†i', 'yu√®n√°n'], hint: 'Âú® = ·ªü', level: 7 },
            { vi: 'S√°ch ·ªü tr√™n b√†n.', zh: '‰π¶Âú®Ê°åÂ≠ê‰∏ä„ÄÇ', words: ['‰π¶', 'Âú®', 'Ê°åÂ≠ê', '‰∏ä'], pinyin: ['sh≈´', 'z√†i', 'zhu≈çzi', 'sh√†ng'], hint: 'Âú® + ƒë·ªãa ƒëi·ªÉm + ‰∏ä/‰∏ã/Èáå', level: 7 },
        ];
        
        // ============ STATE ============
        const state = {
            currentIndex: 0,
            score: 0,
            combo: 0,
            level: 1,
            timeLeft: 60,
            timer: null,
            answered: false,
            hintsUsed: 0,
            answerWords: [],
            shuffledSentences: []
        };
        
        // ============ UI ============
        function updateStats() {
            document.getElementById('stat-score').textContent = state.score;
            document.getElementById('stat-level').textContent = state.level;
            document.getElementById('stat-combo').textContent = state.combo;
            document.getElementById('stat-time').textContent = state.timeLeft;
        }
        
        function shuffleArray(arr) {
            const result = [...arr];
            for (let i = result.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [result[i], result[j]] = [result[j], result[i]];
            }
            return result;
        }
        
        function renderQuestion() {
            const sentence = state.shuffledSentences[state.currentIndex];
            
            document.getElementById('translation-text').textContent = sentence.vi;
            document.getElementById('question-num').textContent = `C√¢u ${state.currentIndex + 1}/${state.shuffledSentences.length}`;
            
            // Shuffle words for word bank
            const shuffledIndices = shuffleArray(sentence.words.map((_, i) => i));
            const wordBank = document.getElementById('word-bank');
            wordBank.innerHTML = shuffledIndices.map(i => `
                <div class="word-chip" draggable="true" data-word="${sentence.words[i]}" data-index="${i}">
                    ${sentence.words[i]}
                    <span class="pinyin">${sentence.pinyin[i]}</span>
                </div>
            `).join('');
            
            // Reset answer zone
            const answerZone = document.getElementById('answer-zone');
            answerZone.innerHTML = '<div class="answer-placeholder">K√©o t·ª´ v√†o ƒë√¢y...</div>';
            answerZone.classList.remove('correct', 'wrong');
            
            state.answerWords = [];
            state.answered = false;
            
            // Hide feedback and hint
            document.getElementById('feedback').classList.remove('show');
            document.getElementById('hint-box').style.display = 'none';
            document.getElementById('btn-check').style.display = 'inline-block';
            document.getElementById('btn-next').style.display = 'none';
            
            // Setup drag and drop
            setupDragDrop();
        }
        
        function setupDragDrop() {
            const wordChips = document.querySelectorAll('.word-chip');
            const answerZone = document.getElementById('answer-zone');
            
            wordChips.forEach(chip => {
                chip.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', chip.dataset.word);
                    chip.classList.add('dragging');
                });
                
                chip.addEventListener('dragend', () => {
                    chip.classList.remove('dragging');
                });
                
                // Click to add
                chip.addEventListener('click', () => {
                    if (state.answered || chip.classList.contains('in-answer')) return;
                    addWordToAnswer(chip.dataset.word, chip);
                });
            });
            
            answerZone.addEventListener('dragover', (e) => {
                e.preventDefault();
                answerZone.classList.add('dragover');
            });
            
            answerZone.addEventListener('dragleave', () => {
                answerZone.classList.remove('dragover');
            });
            
            answerZone.addEventListener('drop', (e) => {
                e.preventDefault();
                answerZone.classList.remove('dragover');
                
                const word = e.dataTransfer.getData('text/plain');
                const chip = document.querySelector(`.word-chip[data-word="${word}"]:not(.in-answer)`);
                if (chip && !state.answered) {
                    addWordToAnswer(word, chip);
                }
            });
        }
        
        function addWordToAnswer(word, chip) {
            const answerZone = document.getElementById('answer-zone');
            
            // Remove placeholder
            const placeholder = answerZone.querySelector('.answer-placeholder');
            if (placeholder) placeholder.remove();
            
            // Add word to answer
            state.answerWords.push(word);
            chip.classList.add('in-answer');
            
            const answerChip = document.createElement('div');
            answerChip.className = 'word-chip in-answer';
            answerChip.textContent = word;
            answerChip.dataset.word = word;
            answerChip.addEventListener('click', () => {
                if (state.answered) return;
                removeWordFromAnswer(word, answerChip, chip);
            });
            answerZone.appendChild(answerChip);
        }
        
        function removeWordFromAnswer(word, answerChip, originalChip) {
            const index = state.answerWords.indexOf(word);
            if (index > -1) {
                state.answerWords.splice(index, 1);
            }
            answerChip.remove();
            originalChip.classList.remove('in-answer');
            
            // Add placeholder if empty
            const answerZone = document.getElementById('answer-zone');
            if (state.answerWords.length === 0) {
                answerZone.innerHTML = '<div class="answer-placeholder">K√©o t·ª´ v√†o ƒë√¢y...</div>';
            }
        }
        
        function checkAnswer() {
            if (state.answered || state.answerWords.length === 0) return;
            state.answered = true;
            
            const sentence = state.shuffledSentences[state.currentIndex];
            const userAnswer = state.answerWords.join('');
            const correctAnswer = sentence.words.join('');
            const isCorrect = userAnswer === correctAnswer;
            
            const answerZone = document.getElementById('answer-zone');
            const feedback = document.getElementById('feedback');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackText = document.getElementById('feedback-text');
            const feedbackCorrect = document.getElementById('feedback-correct');
            
            if (isCorrect) {
                answerZone.classList.add('correct');
                feedback.className = 'feedback show correct';
                feedbackIcon.textContent = '‚úì';
                feedbackText.textContent = `Ch√≠nh x√°c! +${10 + state.combo * 2} ƒëi·ªÉm`;
                feedbackCorrect.textContent = sentence.zh;
                
                state.score += 10 + state.combo * 2;
                state.combo++;
                
                // Level up
                if (state.combo >= 3 && state.level < 7) {
                    state.level++;
                }
                
                // Play TTS
                speak(sentence.zh);
            } else {
                answerZone.classList.add('wrong');
                feedback.className = 'feedback show wrong';
                feedbackIcon.textContent = '‚úó';
                feedbackText.textContent = 'Sai r·ªìi! ƒê√°p √°n ƒë√∫ng:';
                feedbackCorrect.textContent = sentence.zh;
                
                state.combo = 0;
            }
            
            document.getElementById('btn-check').style.display = 'none';
            document.getElementById('btn-next').style.display = 'inline-block';
            
            updateStats();
        }
        
        function nextQuestion() {
            state.currentIndex++;
            
            if (state.currentIndex >= state.shuffledSentences.length) {
                endGame();
                return;
            }
            
            renderQuestion();
        }
        
        function clearAnswer() {
            if (state.answered) return;
            
            state.answerWords = [];
            document.querySelectorAll('.word-chip').forEach(chip => {
                chip.classList.remove('in-answer');
            });
            
            const answerZone = document.getElementById('answer-zone');
            answerZone.innerHTML = '<div class="answer-placeholder">K√©o t·ª´ v√†o ƒë√¢y...</div>';
        }
        
        function showHint() {
            if (state.answered) return;
            
            const sentence = state.shuffledSentences[state.currentIndex];
            document.getElementById('hint-text').textContent = sentence.hint;
            document.getElementById('hint-box').style.display = 'block';
            
            state.score = Math.max(0, state.score - 10);
            state.hintsUsed++;
            updateStats();
        }
        
        function speak(text) {
            const utterance = new SpeechSynthesisUtterance(text);
            utterance.lang = 'zh-CN';
            utterance.rate = 0.8;
            speechSynthesis.speak(utterance);
        }
        
        function startTimer() {
            state.timer = setInterval(() => {
                state.timeLeft--;
                updateStats();
                
                if (state.timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }
        
        function endGame() {
            clearInterval(state.timer);
            
            const accuracy = state.currentIndex > 0 
                ? Math.round((state.score / (state.currentIndex * 10)) * 100) 
                : 0;
            
            let message = '';
            if (state.score >= 100) message = 'üèÜ Xu·∫•t s·∫Øc! B·∫°n gi·ªèi ng·ªØ ph√°p l·∫Øm!';
            else if (state.score >= 50) message = 'üëç T·ªët l·∫Øm! Ti·∫øp t·ª•c luy·ªán t·∫≠p nh√©!';
            else message = 'üí™ C·ªë g·∫Øng th√™m! Xem l·∫°i ph·∫ßn ng·ªØ ph√°p nh√©.';
            
            alert(`üéÆ K·∫øt th√∫c!\n\nƒêi·ªÉm: ${state.score}\nLevel ƒë·∫°t ƒë∆∞·ª£c: ${state.level}\nC√¢u ho√†n th√†nh: ${state.currentIndex}\n\n${message}`);
            
            // Reset
            state.currentIndex = 0;
            state.score = 0;
            state.combo = 0;
            state.level = 1;
            state.timeLeft = 60;
            state.hintsUsed = 0;
            
            initGame();
        }
        
        function initGame() {
            // Filter sentences by level and shuffle
            state.shuffledSentences = shuffleArray(
                SENTENCES.filter(s => s.level <= state.level + 2)
            ).slice(0, 10);
            
            updateStats();
            renderQuestion();
            startTimer();
        }
        
        // ============ INIT ============
        document.getElementById('btn-check').addEventListener('click', checkAnswer);
        document.getElementById('btn-next').addEventListener('click', nextQuestion);
        document.getElementById('btn-clear').addEventListener('click', clearAnswer);
        document.getElementById('btn-hint').addEventListener('click', showHint);
        
        document.getElementById('btn-toggle-grammar').addEventListener('click', () => {
            const tips = document.getElementById('grammar-tips');
            const btn = document.getElementById('btn-toggle-grammar');
            if (tips.style.display === 'none') {
                tips.style.display = 'grid';
                btn.textContent = 'Thu g·ªçn';
            } else {
                tips.style.display = 'none';
                btn.textContent = 'M·ªü r·ªông';
            }
        });
        
        initGame();
    </script>
</body>
</html>
